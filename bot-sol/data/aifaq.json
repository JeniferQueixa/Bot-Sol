{
    "flow": {
        "onboarding": {
            "$contentActions": [
                {
                    "input": {
                        "bypass": false,
                        "$cardContent": {
                            "document": {
                                "id": "65f8b04e-8b1d-402d-a0b6-cf2042d40b77",
                                "type": "text/plain",
                                "content": "Entrada do usu√°rio"
                            },
                            "editable": false,
                            "deletable": false,
                            "position": "right",
                            "editing": false
                        },
                        "$invalid": false
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#2503c648-ab87-4fb5-9915-f12d0ae9a06e",
                    "conditions": [
                        {
                            "comparison": "exists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ],
                    "stateId": "{{dwnCore@fallback}}",
                    "typeOfStateId": "variable",
                    "$invalid": false
                },
                {
                    "stateId": "d52c8170-9a73-4b25-b0e3-a2700f87673c",
                    "typeOfStateId": "state",
                    "$connId": "con_3",
                    "$id": "cea97075-e33f-4add-99a5-c1b6a21c9a4c",
                    "conditions": [
                        {
                            "source": "context",
                            "comparison": "contains",
                            "values": [
                                "Unexpected token"
                            ],
                            "variable": "payloadGpt"
                        }
                    ],
                    "$isBuilderDefaultOutput": true,
                    "$invalid": false
                },
                {
                    "stateId": "e88becf1-e28d-4f32-9b0e-a637f76dff62",
                    "typeOfStateId": "state",
                    "$connId": "con_8",
                    "$id": "041fa39d-5c9c-4826-9f95-ca5c2a542160",
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "startsWith",
                            "values": [
                                "concatPayloadAI:"
                            ]
                        },
                        {
                            "source": "context",
                            "variable": "payloadGpt",
                            "comparison": "exists",
                            "values": []
                        }
                    ],
                    "$isBuilderDefaultOutput": true,
                    "$invalid": false
                },
                {
                    "stateId": "d52c8170-9a73-4b25-b0e3-a2700f87673c",
                    "typeOfStateId": "state",
                    "$connId": "con_13",
                    "$id": "fcb5dd3a-2acd-4935-a211-b3fd38266ca2",
                    "conditions": [
                        {
                            "source": "context",
                            "comparison": "notExists",
                            "values": [],
                            "variable": "payloadGpt"
                        }
                    ],
                    "$isBuilderDefaultOutput": true,
                    "$invalid": false
                },
                {
                    "stateId": "d52c8170-9a73-4b25-b0e3-a2700f87673c",
                    "typeOfStateId": "state",
                    "$connId": "con_18",
                    "$id": "be020018-24bd-403b-94cd-02daa68b42d0",
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "exists",
                            "values": []
                        }
                    ],
                    "$isBuilderDefaultOutput": true,
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [],
            "$leavingCustomActions": [
                {
                    "$id": "DWN/ONB_RST_SCT#3c999643-eb47-4222-b569-87a6ea34ff8e",
                    "$typeOfContent": "",
                    "type": "ExecuteScriptV2",
                    "$title": "DWN [SETTINGS] Reset",
                    "settings": {
                        "function": "dwnRun",
                        "source": "\nvar RESET_CONFIG = {\n  journey: true,\n  errors: true,\n  checkpoints: true,\n  intents: true,\n  services: true,\n  visits: true,\n  group: true\n};\nvar ONLY_ON_MAIN = true;\nasync function dwnRun(coreStr, configStr, errorStr) {\n  coreStr = coreStr || \"\";\n  configStr = configStr || \"\";\n  errorStr = errorStr || \"\";\n  let core = null;\n  let config = null;\n  let error = DwnError.fromDwnError(errorStr);\n  try {\n    core = JSON.parse(coreStr || \"{}\");\n    if (error) {\n      throw error;\n    }\n    try {\n      config = JSON.parse(configStr || \"\");\n    } catch (err) {\n      throw new Error(`config parsing ${String(err)}`);\n    }\n    const IS_MAIN = config.service.current === config.service.main;\n    const allow = ONLY_ON_MAIN ? IS_MAIN : true;\n    if (allow && RESET_CONFIG.journey) {\n      core.journey = \"{{random.guid}}\";\n      core.sessions = (core.sessions || 0) + 1;\n    }\n    if (allow && RESET_CONFIG.errors) {\n      core.errors = [];\n    }\n    if (allow && RESET_CONFIG.checkpoints) {\n      core.checkpoints = [];\n    }\n    if (allow && RESET_CONFIG.intents) {\n      core.intents = { stack: [], groups: [] };\n    }\n    if (allow && RESET_CONFIG.services) {\n      core.services = [];\n    }\n    if (allow && RESET_CONFIG.group) {\n      const GROUP_SEED_RESOLUTION = 1e7;\n      let groups = config.groups || [];\n      let sum = groups.reduce((acc, val) => acc + val, 0);\n      let seed = Math.floor(Math.random() * GROUP_SEED_RESOLUTION);\n      const groupIndex = groups.findIndex((val) => {\n        seed -= val * GROUP_SEED_RESOLUTION / sum;\n        return seed < 0;\n      });\n      const group = groupIndex === -1 ? 0 : groupIndex;\n      core.group = String.fromCharCode(65 + group);\n    }\n    if (allow && RESET_CONFIG.visits) {\n      core.visits = [];\n    }\n    if (IS_MAIN) {\n      core.warnings = [];\n    }\n  } catch (err) {\n    if (!(err instanceof DwnError)) {\n      const description = `[entrypoint-core] Unexpected error ${String(err)}`;\n      const stack = err.stack || \"\";\n      err = new DwnError(\"RUNTIME_ERROR\", description, {\n        stack,\n        goto: null\n      });\n    }\n    error = err;\n  } finally {\n    if (!core || typeof core !== \"object\") {\n      core = null;\n    }\n    coreStr = JSON.stringify(core);\n  }\n  if (error && error.toString() !== errorStr) {\n    await context.setVariableAsync(\"dwnError\", error.toString());\n  }\n  return coreStr;\n}\n/**\n * @imports\n * @version    2.0.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n */\nvar DwnError = class _DwnError extends Error {\n  /**\n   * Creates a new DwnError instance.\n   *\n   * @param {string} type The error type identifier (e.g., \"VALIDATION_ERROR\", \"SCRIPT_ERROR\")\n   * @param {string} description Human-readable description of what went wrong\n   * @param {{message?: string, messages?: string[], stack?: string, goto?: State | null, state?: State, at?: string, intent?: string | null, content?: string, recurrence?: ErrorRecurrence, code?: string | null, status?: FINALIZATION_STATUS}} [extras] Optional additional error context and metadata:\n   * - `message`: Primary error message for user display\n   * - `messages`: Array of error messages for different contexts\n   * - `stack`: Stack trace or execution context information\n   * - `goto`: Target state to redirect to on error (null means terminate)\n   * - `state`: Flow state where the error occurred\n   * - `at`: Location or context where the error occurred\n   * - `intent`: Associated intent that caused the error\n   * - `content`: Additional error content or context\n   * - `recurrence`: Information about error recurrence patterns\n   * - `code`: Error code for programmatic error handling\n   * - `status`: Finalization status indicating how the error was resolved\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid input provided\");\n   *\n   * const contextError = new DwnError(\"SCRIPT_ERROR\", \"Script execution failed\", {\n   *   state: { id: \"state-123\", service: \"main\" },\n   *   intent: \"user-input\",\n   *   content: \"invalid data\",\n   *   messages: [\"First attempt failed\", \"Retry failed\"],\n   *   goto: { id: \"error-handler\", service: \"main\" }\n   * });\n   * ```\n   */\n  constructor(type, description, extras) {\n    super();\n    this.name = \"DwnError\";\n    const _extras = _DwnError.enforceExtras(extras);\n    this.type = type;\n    this.description = description;\n    this.at = _extras.at;\n    this.content = _extras.content;\n    this.state = _extras.state;\n    this.recurrence = _extras.recurrence;\n    this.goto = _extras.goto;\n    this.message = _extras.message || undefined;\n    this.messages = _extras.messages || [];\n    this.intent = _extras.intent || undefined;\n    this.code = _extras.code || undefined;\n    this.status = _extras.status || undefined;\n    this.stack = _extras.stack || undefined;\n    if (!this.stack) {\n      if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, _DwnError);\n      }\n    }\n  }\n  /**\n   * Creates a DwnError instance from a serialized error string.\n   *\n   * Parses a DWN error string in the format \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\"\n   * and reconstructs the original DwnError instance.\n   *\n   * @param {string} dwnErrorString Serialized error string from toString() method\n   * @returns {DwnError | undefined} DwnError instance or undefined if parsing fails\n   *\n   * @example\n   * ```typescript\n   * const errorString = \"SCRIPT_ERROR -|- Execution failed -|- {...}\";\n   * const error = DwnError.fromDwnError(errorString);\n   * ```\n   */\n  static fromDwnError(dwnErrorString) {\n    if (!dwnErrorString) return undefined;\n    const parts = dwnErrorString.split(\"-|-\");\n    let type = parts.shift();\n    if (!type) {\n      return undefined;\n    }\n    type = type.trim();\n    let description = parts.shift() || \"\";\n    if (description) {\n      description = description.trim();\n    }\n    let extras = undefined;\n    try {\n      extras = JSON.parse(parts.shift() || \"{}\");\n    } catch (e) {\n    }\n    if (extras) {\n      return new _DwnError(type, description, extras);\n    }\n    return new _DwnError(type, description);\n  }\n  /**\n   * Creates a DwnError instance from a JSON object.\n   *\n   * Converts a generic Error object or JSON representation into a properly\n   * structured DwnError instance with all required properties.\n   *\n   * @param {Error} data Error object or JSON data to convert\n   * @returns {DwnError} New DwnError instance\n   *\n   * @example\n   * ```typescript\n   * const jsonData = { type: \"API_ERROR\", description: \"Request failed\" };\n   * const error = DwnError.fromJson(jsonData);\n   * ```\n   */\n  static fromJson(data) {\n    const extras = _DwnError.enforceExtras(data);\n    return new _DwnError(data.type, data.description, extras);\n  }\n  /**\n   * Normalizes and validates error extras properties.\n   *\n   * Ensures all optional properties have default values and validates the structure\n   * of the extras object. Used internally to maintain consistency across error instances.\n   *\n   * @param {DwnError | DwnErrorExtras} [entity] Error entity or extras object to normalize\n   * @returns {Required<DwnErrorExtras>} Normalized extras object with all required properties\n   *\n   * @internal\n   */\n  static enforceExtras(entity) {\n    if (!entity) entity = {};\n    const extras = {};\n    extras.message = entity.message || \"\";\n    extras.messages = entity.messages || [];\n    extras.stack = entity.stack || \"\";\n    extras.goto = entity.goto;\n    extras.state = entity.state || { id: \"\", service: \"\" };\n    extras.at = entity.at || (new Date()).toISOString();\n    extras.intent = entity.intent || \"\";\n    extras.content = entity.content || \"\";\n    extras.recurrence = entity.recurrence || { type: 1, state: 1, combined: 1 };\n    extras.code = entity.code || undefined;\n    extras.status = entity.status || undefined;\n    return extras;\n  }\n  /**\n   * Serializes the error to a string format.\n   *\n   * Converts the DwnError instance into a parseable string format using the pattern\n   * \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\" for storage or transmission.\n   *\n   * @returns {string} Serialized error string\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"API_ERROR\", \"Request failed\");\n   * const serialized = error.toString();\n   * // \"API_ERROR -|- Request failed -|- {...}\"\n   * ```\n   */\n  toString() {\n    const extras = JSON.stringify(_DwnError.enforceExtras(this));\n    return `${this.type} -|- ${this.description} -|- ${extras}`;\n  }\n  /**\n   * Converts the error to a JSON object.\n   *\n   * Serializes all error properties into a plain JavaScript object suitable\n   * for JSON serialization, API responses, or logging.\n   *\n   * @returns {Error} Plain object representation of the error\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid data\");\n   * const json = error.toJson();\n   * console.log(JSON.stringify(json, null, 2));\n   * ```\n   */\n  toJson() {\n    return {\n      type: this.type,\n      at: this.at,\n      description: this.description,\n      message: this.message,\n      messages: this.messages || [],\n      stack: this.stack || \"\",\n      intent: this.intent,\n      content: this.content,\n      goto: this.goto,\n      state: this.state,\n      recurrence: this.recurrence\n    };\n  }\n};\nvar SYSTEM_DWN_ERRORS = [\n  \"RUNTIME_ERROR\",\n  \"MISCONFIGURATION_ERROR\"\n];\n",
                        "inputVariables": [
                            "dwnCore",
                            "dwnConfig",
                            "dwnError"
                        ],
                        "outputVariable": "dwnCore"
                    },
                    "conditions": [],
                    "$invalid": false
                },
                {
                    "$id": "DWN/ONB_SET_CNT_PHN#9b663d89-0ab2-4667-b169-3bbfc59ba58e",
                    "$typeOfContent": "",
                    "type": "MergeContact",
                    "$title": "DWN Contact defaults",
                    "settings": {
                        "phoneNumber": "{{dwn@user.phone}}",
                        "extras": {
                            "debug": "",
                            "intent": "",
                            "journey": "{{dwn@journey}}",
                            "sessions": "{{dwn@user.sessions}}"
                        }
                    },
                    "conditions": [
                        {
                            "source": "context",
                            "comparison": "exists",
                            "values": [],
                            "variable": "dwnCore@main"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "DWN/ONB_TRK_CNT_SES#789230ac-702e-4f35-886f-609e0a9f86ad",
                    "$typeOfContent": "",
                    "type": "TrackEvent",
                    "$title": "DWN Contact Sessions",
                    "settings": {
                        "extras": {
                            "journey": "{{dwn@journey}}"
                        },
                        "category": "dwn-contact-sessions",
                        "action": "{{dwnCore@sessions}}"
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwnCore@sessions"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwnCore@main"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "DWN/ONB_TRK_ACC_HR#e0d770ef-cfa1-4701-9a86-877858fb989b",
                    "$typeOfContent": "",
                    "type": "TrackEvent",
                    "$title": "DWN Contact Hour",
                    "settings": {
                        "extras": {
                            "journey": "{{dwn@journey}}"
                        },
                        "category": "dwn-{{dwnCore@service}}-contact-hour",
                        "action": "{{dwn@calendar.hour}}h"
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@calendar.hour"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "40fe9f05-199a-4111-9cc2-0c285e533d83",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "ExecuteScriptV2",
                    "$title": "SET 'firstContent'",
                    "$invalid": false,
                    "settings": {
                        "function": "run",
                        "source": "function run(userInput) {\n\ttry {\n\n        const regexConcat = /concatPayloadAI\\:/g;\n        const regexCameFrom = /cameFrom_aifaq_regexIntent\\:/g;\n\t\treturn userInput.replace(regexConcat, \"\").replace(regexCameFrom, \"\")\n        \n\t} catch (error) {\n\t\treturn userInput;\n\t}\n}",
                        "inputVariables": [
                            "input.content"
                        ],
                        "outputVariable": "firstContent",
                        "LocalTimeZoneEnabled": false
                    },
                    "conditions": [
                        {
                            "comparison": "notExists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ]
                }
            ],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "fallback",
                "$invalid": false
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [],
            "id": "onboarding",
            "root": true,
            "$title": "Onboarding - AI",
            "$position": {
                "top": "119px",
                "left": "644px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "fallback": {
            "$contentActions": [
                {
                    "action": {
                        "$id": "DWN/FALL_ERR_RPT#dec169e2-2235-4eb8-b088-ae7c79877c15-01",
                        "$typeOfContent": "text",
                        "type": "SendMessage",
                        "settings": {
                            "id": "bd5256e0-16f5-4840-a5f3-ff4c0cdc830f",
                            "type": "text/plain",
                            "content": "<b>üö® Debug DWN Error Report üö®</b>\n\n<b>üìÑ Error Summary</b>\n- <b>Type:</b> {{dwn@error.type}}\n- <b>Description:</b> {{dwn@error.description}}\n- <b>Message:</b> {{dwn@error.message}}\n- <b>Intent:</b> {{dwn@error.intent}}\n- <b>Recurrence:</b> {{dwn@error.recurrence.combined}}\n",
                            "metadata": {}
                        },
                        "$cardContent": {
                            "document": {
                                "id": "bd5256e0-16f5-4840-a5f3-ff4c0cdc830f",
                                "type": "text/plain",
                                "content": "<b>üö® Debug DWN Error Report üö®</b>\n\n<b>üìÑ Error Summary</b>\n- <b>Type:</b> {{dwn@error.type}}\n- <b>Description:</b> {{dwn@error.description}}\n- <b>Message:</b> {{dwn@error.message}}\n- <b>Intent:</b> {{dwn@error.intent}}\n- <b>Recurrence:</b> {{dwn@error.recurrence.combined}}\n"
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user.debug",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "action": {
                        "$id": "DWN/FALL_ERR_RPT#dec169e2-2235-4eb8-b088-ae7c79877c15-02",
                        "$typeOfContent": "chat-state",
                        "type": "SendMessage",
                        "settings": {
                            "id": "b272d175-03e0-4374-92c3-839818dc4940",
                            "type": "application/vnd.lime.chatstate+json",
                            "content": {
                                "state": "composing",
                                "interval": 250
                            }
                        },
                        "$cardContent": {
                            "document": {
                                "id": "b272d175-03e0-4374-92c3-839818dc4940",
                                "type": "application/vnd.lime.chatstate+json",
                                "content": {
                                    "state": "composing",
                                    "interval": 250
                                }
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user.debug",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "action": {
                        "$id": "DWN/FALL_ERR_RPT#dec169e2-2235-4eb8-b088-ae7c79877c15-03",
                        "$typeOfContent": "text",
                        "type": "SendMessage",
                        "settings": {
                            "id": "bd5256e0-16f5-4840-a5f3-ff4c0cdc830f",
                            "type": "text/plain",
                            "content": "<b>üìú Stack Trace</b>\n  {{dwn@error.stack}}\n",
                            "metadata": {}
                        },
                        "$cardContent": {
                            "document": {
                                "id": "bd5256e0-16f5-4840-a5f3-ff4c0cdc830f",
                                "type": "text/plain",
                                "content": "<b>üìú Stack Trace</b>\n  {{dwn@error.stack}}\n"
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user.debug",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "action": {
                        "$id": "DWN/FALL_ERR_RPT#dec169e2-2235-4eb8-b088-ae7c79877c15-04",
                        "$typeOfContent": "chat-state",
                        "type": "SendMessage",
                        "settings": {
                            "id": "47c28c47-c8fa-4a1c-8a4e-71c670d5e437",
                            "type": "application/vnd.lime.chatstate+json",
                            "content": {
                                "state": "composing",
                                "interval": 250
                            }
                        },
                        "$cardContent": {
                            "document": {
                                "id": "47c28c47-c8fa-4a1c-8a4e-71c670d5e437",
                                "type": "application/vnd.lime.chatstate+json",
                                "content": {
                                    "state": "composing",
                                    "interval": 250
                                }
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user.debug",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "action": {
                        "$id": "DWN/FALL_ERR_RPT#dec169e2-2235-4eb8-b088-ae7c79877c15-05",
                        "$typeOfContent": "text",
                        "type": "SendMessage",
                        "settings": {
                            "id": "bd5256e0-16f5-4840-a5f3-ff4c0cdc830f",
                            "type": "text/plain",
                            "content": "<b>‚öôÔ∏è Execution Context</b>\n- <b>ID:</b> {{dwn@error.state.id}}\n- <b>Service:</b> {{dwn@error.state.service}}\n- <b>State:</b> {{dwn@error.state.name}}\n\n<b>‚Ü™Ô∏è Return Context</b>\n- <b>ID:</b> {{dwn@error.goto.id}}\n- <b>Service:</b> {{dwn@error.goto.service}}\n- <b>State:</b> {{dwn@error.goto.name}}\n",
                            "metadata": {}
                        },
                        "$cardContent": {
                            "document": {
                                "id": "bd5256e0-16f5-4840-a5f3-ff4c0cdc830f",
                                "type": "text/plain",
                                "content": "<b>‚öôÔ∏è Execution Context</b>\n- <b>ID:</b> {{dwn@error.state.id}}\n- <b>Service:</b> {{dwn@error.state.service}}\n- <b>State:</b> {{dwn@error.state.name}}\n\n<b>‚Ü™Ô∏è Return Context</b>\n- <b>ID:</b> {{dwn@error.goto.id}}\n- <b>Service:</b> {{dwn@error.goto.service}}\n- <b>State:</b> {{dwn@error.goto.name}}\n"
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user.debug",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "action": {
                        "$id": "DWN/FALL_ERR_RPT#dec169e2-2235-4eb8-b088-ae7c79877c15-06",
                        "$typeOfContent": "chat-state",
                        "type": "SendMessage",
                        "settings": {
                            "id": "06fedc59-ca6b-4f87-8aa7-cab8d24d79c7",
                            "type": "application/vnd.lime.chatstate+json",
                            "content": {
                                "state": "composing",
                                "interval": 250
                            }
                        },
                        "$cardContent": {
                            "document": {
                                "id": "06fedc59-ca6b-4f87-8aa7-cab8d24d79c7",
                                "type": "application/vnd.lime.chatstate+json",
                                "content": {
                                    "state": "composing",
                                    "interval": 250
                                }
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwn@user.debug",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "input": {
                        "bypass": true,
                        "$cardContent": {
                            "document": {
                                "id": "78bfb619-9344-47e9-8710-01c45226c569",
                                "type": "text/plain",
                                "content": "User input"
                            },
                            "editable": false,
                            "deletable": false,
                            "position": "right"
                        },
                        "$invalid": false
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "stateId": "error",
                    "conditions": [
                        {
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error",
                            "values": []
                        }
                    ],
                    "$id": "58b6b3fe-c9d0-4bf9-9d66-f15cc394bbfa",
                    "$connId": "con_23",
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [
                {
                    "$id": "DWN/ERR_SCT#180ea77d-91fb-473b-8fc2-e4e85a7e93c2",
                    "$typeOfContent": "",
                    "type": "ExecuteScriptV2",
                    "$title": "DWN Create Error",
                    "settings": {
                        "function": "dwnRun",
                        "source": "/**\n * @author     [Beuren Bechlin] <beuren.bechlin@dawntech.dev>\n * @version    2.0.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n *\n * ---\n *\n * This software is the proprietary property of Dawntech.\n * Possession, use, duplication, or dissemination of this software is strictly\n * prohibited unless you have received prior written permission from\n * Dawntech.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nasync function dwnRun(dwnStr, coreStr, configStr, statesStr, errorStr) {\n  dwnStr = dwnStr || \"\";\n  coreStr = coreStr || \"\";\n  configStr = configStr || \"\";\n  statesStr = statesStr || \"\";\n  errorStr = errorStr || \"\";\n  let warnings = [];\n  let error = DwnError.fromDwnError(errorStr);\n  let core = null;\n  let dwn = null;\n  let states = {};\n  let config = null;\n  try {\n    if (error && SYSTEM_DWN_ERRORS.includes(error.type)) {\n      throw error;\n    }\n    try {\n      core = JSON.parse(coreStr);\n    } catch (err) {\n      warnings.push(`[create-error] Unexpected core JSON ${String(err)}`);\n      throw new Error(`core parsing ${String(err)}`);\n    }\n    warnings = core.warnings;\n    try {\n      dwn = JSON.parse(dwnStr);\n    } catch (err) {\n      warnings.push(`[create-error] Unexpected dwn JSON ${String(err)}`);\n      throw new Error(`dwn parsing ${String(err)}`);\n    }\n    try {\n      states = JSON.parse(statesStr);\n    } catch (err) {\n      warnings.push(`[create-error] Unexpected states JSON ${String(err)}`);\n      throw new Error(`states parsing ${String(err)}`);\n    }\n    try {\n      config = JSON.parse(configStr);\n    } catch (err) {\n      warnings.push(`[create-error] Unexpected config JSON ${String(err)}`);\n      throw new Error(`config parsing ${String(err)}`);\n    }\n    let type = config.error.type;\n    let intent = dwn.intent ? dwn.intent.id : null;\n    let description = undefined;\n    let messages = config.error.messages || [];\n    let state = enforceState(\n      \"{{state.previous.id}}\",\n      core.service,\n      states\n    );\n    let goto = null;\n    if (error) {\n      type = error.type;\n      description = error.description;\n      messages = error.messages || [];\n      if (error.message) {\n        messages = [error.message];\n      }\n      if (error.goto === undefined) {\n        goto = state;\n      } else {\n        goto = error.goto;\n      }\n    } else {\n      error = new DwnError(type, \"Default error\");\n      description = \"Default error\";\n      goto = config.error.goto === undefined ? state : config.error.goto;\n    }\n    if (intent === \"CHECKPOINT_BACK\") {\n      const checkpointIndex = core.checkpoints.findIndex(\n        (checkpoint) => checkpoint.id === core.state.id && checkpoint.service === core.service\n      );\n      if (checkpointIndex >= 0) {\n        core.checkpoints.splice(0, checkpointIndex + 1);\n      }\n    } else if (core.checkpoint) {\n      if (!(dwn.intent && dwn.intent.id && dwn.intent.scope === \"prepare\")) {\n        core.checkpoints.splice(0, 1);\n      }\n    }\n    if (dwn.intent && dwn.intent.scope === \"stack\") {\n      const stackIndex = core.intents.stack.findIndex(\n        (intentsGroup) => intentsGroup.id === dwn.intent.event\n      );\n      if (stackIndex >= 0) {\n        core.intents.stack.splice(0, stackIndex + 1);\n      }\n    }\n    if (type === \"PROPAGATE\") {\n      throw DwnError.fromJson(dwn.error);\n    }\n    if (type === \"RUNTIME_ERROR\") {\n      throw error;\n    }\n    const recurrence = error.recurrence;\n    const lastError = core.errors[0];\n    if (lastError && recurrence.combined > 0) {\n      if (lastError.state.id == state.id) {\n        recurrence.state = lastError.recurrence.state + 1;\n      }\n      if (lastError.type == type) {\n        recurrence.type = lastError.recurrence.type + 1;\n      }\n      recurrence.combined = Math.min(recurrence.state, recurrence.type);\n    }\n    error.type = type;\n    error.at = dwn.calendar.datetime;\n    error.content = dwn.input.content;\n    error.state = state;\n    error.recurrence = recurrence;\n    error.goto = enforceState(goto, core.service, states);\n    error.intent = intent;\n    error.description = description;\n    error.message = error.message || undefined;\n    if (messages.length === 0 && error.intent && error.intent in config.messages.intent) {\n      messages = config.messages.intent[error.intent];\n    }\n    if (messages.length === 0 && dwn.input.type in config.messages.type) {\n      messages = config.messages.type[dwn.input.type];\n    }\n    if (messages.length === 0 && error.type in config.messages.error) {\n      messages = config.messages.error[error.type];\n    }\n    error.messages = messages;\n  } catch (err) {\n    if (!(err instanceof DwnError)) {\n      const description = `[create-error] Unexpected error ${String(err)}`;\n      const stack = err.stack || \"\";\n      err = new DwnError(\"RUNTIME_ERROR\", description, {\n        stack,\n        goto: null\n      });\n    }\n    error = err;\n  } finally {\n    if (!core || typeof core !== \"object\") {\n      core = {};\n    }\n    if (error) {\n      core.error = error.toJson();\n    }\n    core.warnings = warnings;\n    coreStr = JSON.stringify(core);\n  }\n  if (error) {\n    await context.deleteVariableAsync(\"dwnError\");\n  }\n  return coreStr;\n}\n/**\n * @imports\n * @version    2.0.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n */\nvar DwnError = class _DwnError extends Error {\n  /**\n   * Creates a new DwnError instance.\n   *\n   * @param {string} type The error type identifier (e.g., \"VALIDATION_ERROR\", \"SCRIPT_ERROR\")\n   * @param {string} description Human-readable description of what went wrong\n   * @param {{message?: string, messages?: string[], stack?: string, goto?: State | null, state?: State, at?: string, intent?: string | null, content?: string, recurrence?: ErrorRecurrence, code?: string | null, status?: FINALIZATION_STATUS}} [extras] Optional additional error context and metadata:\n   * - `message`: Primary error message for user display\n   * - `messages`: Array of error messages for different contexts\n   * - `stack`: Stack trace or execution context information\n   * - `goto`: Target state to redirect to on error (null means terminate)\n   * - `state`: Flow state where the error occurred\n   * - `at`: Location or context where the error occurred\n   * - `intent`: Associated intent that caused the error\n   * - `content`: Additional error content or context\n   * - `recurrence`: Information about error recurrence patterns\n   * - `code`: Error code for programmatic error handling\n   * - `status`: Finalization status indicating how the error was resolved\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid input provided\");\n   *\n   * const contextError = new DwnError(\"SCRIPT_ERROR\", \"Script execution failed\", {\n   *   state: { id: \"state-123\", service: \"main\" },\n   *   intent: \"user-input\",\n   *   content: \"invalid data\",\n   *   messages: [\"First attempt failed\", \"Retry failed\"],\n   *   goto: { id: \"error-handler\", service: \"main\" }\n   * });\n   * ```\n   */\n  constructor(type, description, extras) {\n    super();\n    this.name = \"DwnError\";\n    const _extras = _DwnError.enforceExtras(extras);\n    this.type = type;\n    this.description = description;\n    this.at = _extras.at;\n    this.content = _extras.content;\n    this.state = _extras.state;\n    this.recurrence = _extras.recurrence;\n    this.goto = _extras.goto;\n    this.message = _extras.message || undefined;\n    this.messages = _extras.messages || [];\n    this.intent = _extras.intent || undefined;\n    this.code = _extras.code || undefined;\n    this.status = _extras.status || undefined;\n    this.stack = _extras.stack || undefined;\n    if (!this.stack) {\n      if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, _DwnError);\n      }\n    }\n  }\n  /**\n   * Creates a DwnError instance from a serialized error string.\n   *\n   * Parses a DWN error string in the format \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\"\n   * and reconstructs the original DwnError instance.\n   *\n   * @param {string} dwnErrorString Serialized error string from toString() method\n   * @returns {DwnError | undefined} DwnError instance or undefined if parsing fails\n   *\n   * @example\n   * ```typescript\n   * const errorString = \"SCRIPT_ERROR -|- Execution failed -|- {...}\";\n   * const error = DwnError.fromDwnError(errorString);\n   * ```\n   */\n  static fromDwnError(dwnErrorString) {\n    if (!dwnErrorString) return undefined;\n    const parts = dwnErrorString.split(\"-|-\");\n    let type = parts.shift();\n    if (!type) {\n      return undefined;\n    }\n    type = type.trim();\n    let description = parts.shift() || \"\";\n    if (description) {\n      description = description.trim();\n    }\n    let extras = undefined;\n    try {\n      extras = JSON.parse(parts.shift() || \"{}\");\n    } catch (e) {\n    }\n    if (extras) {\n      return new _DwnError(type, description, extras);\n    }\n    return new _DwnError(type, description);\n  }\n  /**\n   * Creates a DwnError instance from a JSON object.\n   *\n   * Converts a generic Error object or JSON representation into a properly\n   * structured DwnError instance with all required properties.\n   *\n   * @param {Error} data Error object or JSON data to convert\n   * @returns {DwnError} New DwnError instance\n   *\n   * @example\n   * ```typescript\n   * const jsonData = { type: \"API_ERROR\", description: \"Request failed\" };\n   * const error = DwnError.fromJson(jsonData);\n   * ```\n   */\n  static fromJson(data) {\n    const extras = _DwnError.enforceExtras(data);\n    return new _DwnError(data.type, data.description, extras);\n  }\n  /**\n   * Normalizes and validates error extras properties.\n   *\n   * Ensures all optional properties have default values and validates the structure\n   * of the extras object. Used internally to maintain consistency across error instances.\n   *\n   * @param {DwnError | DwnErrorExtras} [entity] Error entity or extras object to normalize\n   * @returns {Required<DwnErrorExtras>} Normalized extras object with all required properties\n   *\n   * @internal\n   */\n  static enforceExtras(entity) {\n    if (!entity) entity = {};\n    const extras = {};\n    extras.message = entity.message || \"\";\n    extras.messages = entity.messages || [];\n    extras.stack = entity.stack || \"\";\n    extras.goto = entity.goto;\n    extras.state = entity.state || { id: \"\", service: \"\" };\n    extras.at = entity.at || (new Date()).toISOString();\n    extras.intent = entity.intent || \"\";\n    extras.content = entity.content || \"\";\n    extras.recurrence = entity.recurrence || { type: 1, state: 1, combined: 1 };\n    extras.code = entity.code || undefined;\n    extras.status = entity.status || undefined;\n    return extras;\n  }\n  /**\n   * Serializes the error to a string format.\n   *\n   * Converts the DwnError instance into a parseable string format using the pattern\n   * \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\" for storage or transmission.\n   *\n   * @returns {string} Serialized error string\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"API_ERROR\", \"Request failed\");\n   * const serialized = error.toString();\n   * // \"API_ERROR -|- Request failed -|- {...}\"\n   * ```\n   */\n  toString() {\n    const extras = JSON.stringify(_DwnError.enforceExtras(this));\n    return `${this.type} -|- ${this.description} -|- ${extras}`;\n  }\n  /**\n   * Converts the error to a JSON object.\n   *\n   * Serializes all error properties into a plain JavaScript object suitable\n   * for JSON serialization, API responses, or logging.\n   *\n   * @returns {Error} Plain object representation of the error\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid data\");\n   * const json = error.toJson();\n   * console.log(JSON.stringify(json, null, 2));\n   * ```\n   */\n  toJson() {\n    return {\n      type: this.type,\n      at: this.at,\n      description: this.description,\n      message: this.message,\n      messages: this.messages || [],\n      stack: this.stack || \"\",\n      intent: this.intent,\n      content: this.content,\n      goto: this.goto,\n      state: this.state,\n      recurrence: this.recurrence\n    };\n  }\n};\nvar SYSTEM_DWN_ERRORS = [\n  \"RUNTIME_ERROR\",\n  \"MISCONFIGURATION_ERROR\"\n];\n\n\nfunction enforceState(state, currentService, states) {\n  if (!state && typeof state !== \"string\") {\n    return state;\n  }\n  const id = typeof state === \"string\" ? state : state.id;\n  if (!id) {\n    throw new DwnError(\n      \"MISCONFIGURATION_ERROR\",\n      `State ${JSON.stringify(state)} must have 'id' property.`\n    );\n  }\n  const key = `${id}@${currentService}`;\n  let service = typeof state === \"string\" ? currentService : state.service;\n  if (!service) {\n    service = currentService;\n  }\n  let name = typeof state === \"string\" ? \"\" : state.name;\n  if (!name) {\n    name = states[key] || undefined;\n  }\n  return { id, service, name };\n}\n",
                        "inputVariables": [
                            "dwn",
                            "dwnCore",
                            "dwnConfig",
                            "dwnStates",
                            "dwnError"
                        ],
                        "outputVariable": "dwnCore"
                    },
                    "conditions": [],
                    "$invalid": false
                },
                {
                    "$id": "DWN/ERR_CLR_TYP#c44a51f1-f9d8-4822-8bb3-0c1667fb890b",
                    "$typeOfContent": "",
                    "type": "ExecuteScriptV2",
                    "$title": "DWN [SETTINGS] Process Error",
                    "settings": {
                        "function": "dwnRun",
                        "source": "/**\n * @author     [Beuren Bechlin] <beuren.bechlin@dawntech.dev>\n * @version    1.1.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n *\n * ---\n *\n * This software is the proprietary property of Dawntech.\n * Possession, use, duplication, or dissemination of this software is strictly\n * prohibited unless you have received prior written permission from\n * Dawntech.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nasync function processError(error, errors, dwn, core, config) {\n  if (error.type !== \"INTENT\" && error.recurrence.combined >= 3) {\n    const messages = config.messages.error[\"RECURRENT_ERROR\"] || [];\n    error.type = \"RECURRENT_ERROR\";\n    error.message = rotateMessages(messages, errors);\n    error.description = \"Recurrence detected\";\n    error.goto = null;\n    return error;\n  }\n  if (error.type === \"INACTIVITY\" && config.messages.error[\"INACTIVITY\"] && config.messages.error[\"INACTIVITY\"].length > 1) {\n    const isFinal = error.recurrence.combined === config.messages.error[\"INACTIVITY\"].length;\n    if (!isFinal) {\n      error.description = \"Intermidiate inactivity message, waiting for user.\";\n      error.goto = error.state;\n    } else {\n      error.description = \"Final inactivity message, closing conversation.\";\n      error.goto = null;\n    }\n    error.message = rotateMessages(\n      config.messages.error[\"INACTIVITY\"],\n      errors\n    );\n    return error;\n  }\n  switch (error.type) {\n    // Exemplo de tratamento de erro espec√≠fico\n    case \"BLOCKED_CONTACT\":\n      error.message = rotateMessages(\n        [\n          \"Desculpe, voc√™ n√£o pode interagir com este servi√ßo. Entre em contato com o suporte para mais informa√ß√µes.\",\n          \"Desculpe, voc√™ foi bloqueado de interagir com este servi√ßo. Entre em contato com o suporte para mais informa√ß√µes.\"\n        ],\n        errors\n      );\n      error.goto = null;\n      break;\n  }\n  return error;\n}\nfunction rotateMessages(messages, errors) {\n  if (!messages || !Array.isArray(messages) || messages.length === 0) {\n    return undefined;\n  }\n  if (!errors || !Array.isArray(errors) || errors.length === 0) {\n    return messages[0] || undefined;\n  }\n  const lastErrorMessage = errors[0] ? errors[0].message : \"\";\n  const lastMessageIndex = messages.findIndex((m) => m === lastErrorMessage);\n  return messages[(lastMessageIndex + 1) % messages.length] || undefined;\n}\nasync function dwnRun(dwnStr, coreStr, configStr, statesStr, errorStr) {\n  dwnStr = dwnStr || \"\";\n  coreStr = coreStr || \"\";\n  configStr = configStr || \"\";\n  statesStr = statesStr || \"\";\n  errorStr = errorStr || \"\";\n  let service = {\n    current: \"AI\",\n    main: \"Main\"\n  };\n  let propagate = service.current !== service.main ? service.main : undefined;\n  let warnings = [];\n  let error = new DwnError(\n    \"RUNTIME_ERROR\",\n    \"Default error\",\n    { goto: null }\n  );\n  let core = null;\n  let dwn = null;\n  let states = {};\n  let config = null;\n  try {\n    try {\n      core = JSON.parse(coreStr);\n    } catch (err) {\n      warnings.push(`[process-error] Unexpected core JSON ${String(err)}`);\n      throw new Error(`core parsing ${String(err)}`);\n    }\n    warnings = core.warnings;\n    try {\n      dwn = JSON.parse(dwnStr);\n    } catch (err) {\n      warnings.push(`[process-error] Unexpected dwn JSON ${String(err)}`);\n      throw new Error(`dwn parsing ${String(err)}`);\n    }\n    try {\n      states = JSON.parse(statesStr);\n    } catch (err) {\n      warnings.push(`[process-error] Unexpected states JSON ${String(err)}`);\n      throw new Error(`states parsing ${String(err)}`);\n    }\n    if (!core.error) {\n      warnings.push(`[process-error] core error is not defined`);\n      throw new Error(\"core error is not defined\");\n    }\n    try {\n      const error2 = DwnError.fromJson(core.error);\n      if (!error2) throw new Error(\"core error is not defined\");\n      if (error2 && SYSTEM_DWN_ERRORS.includes(error2.type)) {\n        throw error2;\n      }\n      config = JSON.parse(configStr);\n    } catch (error2) {\n      warnings.push(`[process-error] Unexpected error ${String(error2)}`);\n      throw error2;\n    }\n    service = config.service;\n    propagate = core.propagate;\n    let _error = core.error;\n    _error.message = rotateMessages(core.messages, core.errors);\n    _error = await processError(_error, core.errors, dwn, core, config);\n    _error.goto = enforceState(_error.goto, service.current, states);\n    core.errors = core.errors.slice(0, config.stackSize.errors);\n    core.errors.unshift(_error);\n    error = DwnError.fromJson(_error);\n  } catch (err) {\n    if (!(err instanceof DwnError)) {\n      const description = `[process-error] Unexpected error ${String(err)}`;\n      const stack = err.stack || \"\";\n      err = new DwnError(\"RUNTIME_ERROR\", description, {\n        stack,\n        goto: null\n      });\n    }\n    error = err;\n  } finally {\n    if (!dwn || typeof dwn !== \"object\") {\n      dwn = {};\n    }\n    if (!core || typeof core !== \"object\") {\n      core = {};\n    }\n    core.propagate = propagate;\n    if (SYSTEM_DWN_ERRORS.includes(error.type)) {\n      error = systemErrorRecovery(error, service);\n    }\n    if (error.code && error.message) {\n      error.message = error.message.replace(\"{{code}}\", error.code);\n    }\n    if (error.goto) {\n      if (!error.goto.service) {\n        error.goto.service = service.current;\n      }\n      if (!error.goto.id) {\n        error.goto.id = \"onboarding\";\n      }\n      if (error.goto.service !== service.current) {\n        core.redirect = true;\n      }\n      errorStr = \"\";\n    } else {\n      if (core.propagate) {\n        core.redirect = true;\n        errorStr = \"PROPAGATE\";\n      }\n      error.goto = undefined;\n    }\n    core.error = error.toJson();\n    dwn.error = error.toJson();\n    core.warnings = warnings;\n    if (core.warnings.length > 0) {\n      dwn.warnings = core.warnings.join(\"\\n\");\n    }\n    dwnStr = JSON.stringify(dwn);\n  }\n  if (errorStr === \"PROPAGATE\") {\n    await context.setVariableAsync(\"dwnError\", errorStr);\n  }\n  if (core && typeof core === \"object\") {\n    await context.setVariableAsync(\"dwnCore\", JSON.stringify(core));\n  }\n  return dwnStr;\n}\nfunction systemErrorRecovery(error, services) {\n  const messages = {\n    [\"RUNTIME_ERROR\"]: \"Desculpe, houve um erro inesperado. Por favor, tente novamente mais tarde.\",\n    [\"MISCONFIGURATION_ERROR\"]: \"Desculpe, houve uma falha inesperada. Por favor, tente novamente mais tarde.\"\n  };\n  if (messages[error.type]) {\n    error.message = messages[error.type];\n  } else {\n    error.message = messages[\"RUNTIME_ERROR\"];\n  }\n  if (services.current === services.main) {\n    error.goto = undefined;\n  } else {\n    error.goto = {\n      id: \"onboarding\",\n      service: services.main\n    };\n  }\n  return error;\n}\n/**\n * @imports\n * @version    1.1.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n */\nvar DwnError = class _DwnError extends Error {\n  /**\n   * Creates a new DwnError instance.\n   *\n   * @param {string} type The error type identifier (e.g., \"VALIDATION_ERROR\", \"SCRIPT_ERROR\")\n   * @param {string} description Human-readable description of what went wrong\n   * @param {{message?: string, messages?: string[], stack?: string, goto?: State | null, state?: State, at?: string, intent?: string | null, content?: string, recurrence?: ErrorRecurrence, code?: string | null, status?: FINALIZATION_STATUS}} [extras] Optional additional error context and metadata:\n   * - `message`: Primary error message for user display\n   * - `messages`: Array of error messages for different contexts\n   * - `stack`: Stack trace or execution context information\n   * - `goto`: Target state to redirect to on error (null means terminate)\n   * - `state`: Flow state where the error occurred\n   * - `at`: Location or context where the error occurred\n   * - `intent`: Associated intent that caused the error\n   * - `content`: Additional error content or context\n   * - `recurrence`: Information about error recurrence patterns\n   * - `code`: Error code for programmatic error handling\n   * - `status`: Finalization status indicating how the error was resolved\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid input provided\");\n   *\n   * const contextError = new DwnError(\"SCRIPT_ERROR\", \"Script execution failed\", {\n   *   state: { id: \"state-123\", service: \"main\" },\n   *   intent: \"user-input\",\n   *   content: \"invalid data\",\n   *   messages: [\"First attempt failed\", \"Retry failed\"],\n   *   goto: { id: \"error-handler\", service: \"main\" }\n   * });\n   * ```\n   */\n  constructor(type, description, extras) {\n    super();\n    this.name = \"DwnError\";\n    const _extras = _DwnError.enforceExtras(extras);\n    this.type = type;\n    this.description = description;\n    this.at = _extras.at;\n    this.content = _extras.content;\n    this.state = _extras.state;\n    this.recurrence = _extras.recurrence;\n    this.goto = _extras.goto;\n    this.message = _extras.message || undefined;\n    this.messages = _extras.messages || [];\n    this.intent = _extras.intent || undefined;\n    this.code = _extras.code || undefined;\n    this.status = _extras.status || undefined;\n    this.stack = _extras.stack || undefined;\n    if (!this.stack) {\n      if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, _DwnError);\n      }\n    }\n  }\n  /**\n   * Creates a DwnError instance from a serialized error string.\n   *\n   * Parses a DWN error string in the format \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\"\n   * and reconstructs the original DwnError instance.\n   *\n   * @param {string} dwnErrorString Serialized error string from toString() method\n   * @returns {DwnError | undefined} DwnError instance or undefined if parsing fails\n   *\n   * @example\n   * ```typescript\n   * const errorString = \"SCRIPT_ERROR -|- Execution failed -|- {...}\";\n   * const error = DwnError.fromDwnError(errorString);\n   * ```\n   */\n  static fromDwnError(dwnErrorString) {\n    if (!dwnErrorString) return undefined;\n    const parts = dwnErrorString.split(\"-|-\");\n    let type = parts.shift();\n    if (!type) {\n      return undefined;\n    }\n    type = type.trim();\n    let description = parts.shift() || \"\";\n    if (description) {\n      description = description.trim();\n    }\n    let extras = undefined;\n    try {\n      extras = JSON.parse(parts.shift() || \"{}\");\n    } catch (e) {\n    }\n    if (extras) {\n      return new _DwnError(type, description, extras);\n    }\n    return new _DwnError(type, description);\n  }\n  /**\n   * Creates a DwnError instance from a JSON object.\n   *\n   * Converts a generic Error object or JSON representation into a properly\n   * structured DwnError instance with all required properties.\n   *\n   * @param {Error} data Error object or JSON data to convert\n   * @returns {DwnError} New DwnError instance\n   *\n   * @example\n   * ```typescript\n   * const jsonData = { type: \"API_ERROR\", description: \"Request failed\" };\n   * const error = DwnError.fromJson(jsonData);\n   * ```\n   */\n  static fromJson(data) {\n    const extras = _DwnError.enforceExtras(data);\n    return new _DwnError(data.type, data.description, extras);\n  }\n  /**\n   * Normalizes and validates error extras properties.\n   *\n   * Ensures all optional properties have default values and validates the structure\n   * of the extras object. Used internally to maintain consistency across error instances.\n   *\n   * @param {DwnError | DwnErrorExtras} [entity] Error entity or extras object to normalize\n   * @returns {Required<DwnErrorExtras>} Normalized extras object with all required properties\n   *\n   * @internal\n   */\n  static enforceExtras(entity) {\n    if (!entity) entity = {};\n    const extras = {};\n    extras.message = entity.message || \"\";\n    extras.messages = entity.messages || [];\n    extras.stack = entity.stack || \"\";\n    extras.goto = entity.goto;\n    extras.state = entity.state || { id: \"\", service: \"\" };\n    extras.at = entity.at || (new Date()).toISOString();\n    extras.intent = entity.intent || \"\";\n    extras.content = entity.content || \"\";\n    extras.recurrence = entity.recurrence || { type: 1, state: 1, combined: 1 };\n    extras.code = entity.code || undefined;\n    extras.status = entity.status || undefined;\n    return extras;\n  }\n  /**\n   * Serializes the error to a string format.\n   *\n   * Converts the DwnError instance into a parseable string format using the pattern\n   * \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\" for storage or transmission.\n   *\n   * @returns {string} Serialized error string\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"API_ERROR\", \"Request failed\");\n   * const serialized = error.toString();\n   * // \"API_ERROR -|- Request failed -|- {...}\"\n   * ```\n   */\n  toString() {\n    const extras = JSON.stringify(_DwnError.enforceExtras(this));\n    return `${this.type} -|- ${this.description} -|- ${extras}`;\n  }\n  /**\n   * Converts the error to a JSON object.\n   *\n   * Serializes all error properties into a plain JavaScript object suitable\n   * for JSON serialization, API responses, or logging.\n   *\n   * @returns {Error} Plain object representation of the error\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid data\");\n   * const json = error.toJson();\n   * console.log(JSON.stringify(json, null, 2));\n   * ```\n   */\n  toJson() {\n    return {\n      type: this.type,\n      at: this.at,\n      description: this.description,\n      message: this.message,\n      messages: this.messages || [],\n      stack: this.stack || \"\",\n      intent: this.intent,\n      content: this.content,\n      goto: this.goto,\n      state: this.state,\n      recurrence: this.recurrence\n    };\n  }\n};\nvar SYSTEM_DWN_ERRORS = [\n  \"RUNTIME_ERROR\",\n  \"MISCONFIGURATION_ERROR\"\n];\n\n\nfunction enforceState(state, currentService, states) {\n  if (!state && typeof state !== \"string\") {\n    return state;\n  }\n  const id = typeof state === \"string\" ? state : state.id;\n  if (!id) {\n    throw new DwnError(\n      \"MISCONFIGURATION_ERROR\",\n      `State ${JSON.stringify(state)} must have 'id' property.`\n    );\n  }\n  const key = `${id}@${currentService}`;\n  let service = typeof state === \"string\" ? currentService : state.service;\n  if (!service) {\n    service = currentService;\n  }\n  let name = typeof state === \"string\" ? \"\" : state.name;\n  if (!name) {\n    name = states[key] || undefined;\n  }\n  return { id, service, name };\n}\n",
                        "inputVariables": [
                            "dwn",
                            "dwnCore",
                            "dwnConfig",
                            "dwnStates",
                            "dwnError"
                        ],
                        "outputVariable": "dwn"
                    },
                    "conditions": [],
                    "$invalid": false
                }
            ],
            "$leavingCustomActions": [
                {
                    "$id": "DWN/FALL_DBG_CNT#4583318f-2a47-49e5-9723-152799261436",
                    "$typeOfContent": "",
                    "type": "MergeContact",
                    "$title": "DWN Invert user debug",
                    "settings": {
                        "extras": {
                            "debug": "{{dwn@user.debug}}"
                        }
                    },
                    "conditions": [
                        {
                            "source": "context",
                            "comparison": "notExists",
                            "values": [],
                            "variable": "dwnError"
                        },
                        {
                            "source": "context",
                            "comparison": "exists",
                            "values": [],
                            "variable": "dwn@error"
                        },
                        {
                            "source": "context",
                            "comparison": "equals",
                            "variable": "dwn@error.type",
                            "values": [
                                "DEBUG"
                            ]
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "DWN/FALL_TRK_ERR_GLB#f1f50077-eb8f-4ebc-bc8a-16463ffc73e6",
                    "$typeOfContent": "",
                    "type": "TrackEvent",
                    "$title": "DWN Global errors by type",
                    "settings": {
                        "extras": {
                            "journey": "{{dwn@journey}}"
                        },
                        "category": "dwn-global-errors-by-type",
                        "action": "{{dwn@error.type}}"
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "notExists",
                            "variable": "dwnError"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error.type"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "DWN/FALL_TRK_ERR_LOC#94f61bc5-bb4e-48bc-9bf4-e5366db55711",
                    "$typeOfContent": "",
                    "type": "TrackEvent",
                    "$title": "DWN Local errors by type",
                    "settings": {
                        "extras": {
                            "journey": "{{dwn@journey}}"
                        },
                        "category": "dwn-{{dwnCore@service}}-errors-by-type",
                        "action": "{{dwn@error.type}}"
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "notExists",
                            "variable": "dwnError"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error.type"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "DWN/FALL_TRK_ERR_GLB_NO_UNX#110c6841-ae16-4d45-a0e9-f190249b6502",
                    "$typeOfContent": "",
                    "type": "TrackEvent",
                    "$title": "DWN Global errors by type excluding unexpected",
                    "settings": {
                        "extras": {
                            "journey": "{{dwn@journey}}"
                        },
                        "category": "dwn-global-errors-by-type-no-unexpected",
                        "action": "{{dwn@error.type}}"
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "notExists",
                            "variable": "dwnError"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error.type"
                        },
                        {
                            "values": [
                                "UNEXPECTED_INPUT"
                            ],
                            "source": "context",
                            "comparison": "notEquals",
                            "variable": "dwn@error.type"
                        },
                        {
                            "values": [
                                "UNEXPECTED_OPTION"
                            ],
                            "source": "context",
                            "comparison": "notEquals",
                            "variable": "dwn@error.type"
                        },
                        {
                            "values": [
                                "INTENT"
                            ],
                            "source": "context",
                            "comparison": "notEquals",
                            "variable": "dwn@error.type"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "DWN/FALL_TRK_ERR_LOC_NO_UNX#6403807e-c0e0-444f-a84c-17cf2e45ae94",
                    "$typeOfContent": "",
                    "type": "TrackEvent",
                    "$title": "DWN Local errors by type excluding unexpected",
                    "settings": {
                        "extras": {
                            "journey": "{{dwn@journey}}"
                        },
                        "category": "dwn-{{dwnCore@service}}-errors-by-type-no-unexpected",
                        "action": "{{dwn@error.type}}"
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "notExists",
                            "variable": "dwnError"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error.type"
                        },
                        {
                            "values": [
                                "UNEXPECTED_INPUT"
                            ],
                            "source": "context",
                            "comparison": "notEquals",
                            "variable": "dwn@error"
                        },
                        {
                            "values": [
                                "UNEXPECTED_OPTION"
                            ],
                            "source": "context",
                            "comparison": "notEquals",
                            "variable": "dwn@error"
                        },
                        {
                            "values": [
                                "INTENT"
                            ],
                            "source": "context",
                            "comparison": "notEquals",
                            "variable": "dwn@error"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "DWN/FALL_TRK_ERR_LST#f7b2609f-3798-4233-966a-9807ce5eca88",
                    "$typeOfContent": "",
                    "type": "TrackEvent",
                    "$title": "DWN Global errors by type list",
                    "settings": {
                        "extras": {
                            "journey": "{{dwn@journey}}"
                        },
                        "category": "dwn-errors-by-type-list",
                        "action": "{{dwn@error.at}} | {{contact.identity}} | {{dwn@error.type}} | {{dwn@error.state.id}} | {{dwn@error.state.service}}"
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "notExists",
                            "variable": "dwnError"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "DWN/FALL_TRK_ERR_LST_NO_UNX#175523f1-37d5-4d93-9d4c-8d0e1e439de6",
                    "$typeOfContent": "",
                    "type": "TrackEvent",
                    "$title": "DWN Global errors by type excluding unexpected list",
                    "settings": {
                        "extras": {
                            "journey": "{{dwn@journey}}"
                        },
                        "category": "dwn-errors-by-type-list-no-unexpected",
                        "action": "{{dwn@error.at}} | {{contact.identity}} | {{dwn@error.state.id}} | {{dwn@error.state.service}} | {{dwn@error.stack}}"
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "notExists",
                            "variable": "dwnError"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error.type"
                        },
                        {
                            "values": [
                                "UNEXPECTED_INPUT"
                            ],
                            "source": "context",
                            "comparison": "notEquals",
                            "variable": "dwn@error"
                        },
                        {
                            "values": [
                                "UNEXPECTED_OPTION"
                            ],
                            "source": "context",
                            "comparison": "notEquals",
                            "variable": "dwn@error"
                        },
                        {
                            "values": [
                                "INTENT"
                            ],
                            "source": "context",
                            "comparison": "notEquals",
                            "variable": "dwn@error"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "DWN/FALL_TRK_ABD#e76cff23-a86e-411d-8555-67736df6c423",
                    "$typeOfContent": "",
                    "type": "TrackEvent",
                    "$title": "DWN Abandonment rate",
                    "settings": {
                        "extras": {
                            "journey": "{{dwn@journey}}"
                        },
                        "category": "dwn-finalization-status",
                        "action": "{{dwn@error.status}}"
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "notExists",
                            "variable": "dwnError"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "notExists",
                            "variable": "dwn@error.goto"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error.status"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "DWN/FALL_BUB_ERR#5955fb78-d740-4625-b5e7-16ab3d80d542",
                    "$typeOfContent": "",
                    "type": "TrackEvent",
                    "$title": "DWN Bubbled errors by type",
                    "settings": {
                        "extras": {
                            "journey": "{{dwn@journey}}"
                        },
                        "category": "dwn-bubbled-errors-by-type",
                        "action": "{{dwn@error.type}}"
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "notExists",
                            "variable": "dwnError"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error.type"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "notExists",
                            "variable": "dwn@error.goto"
                        }
                    ],
                    "$invalid": false
                }
            ],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "onboarding",
                "$invalid": false
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [],
            "id": "fallback",
            "$title": "Fallback - AI",
            "$position": {
                "top": "120px",
                "left": "877px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "error": {
            "$contentActions": [
                {
                    "action": {
                        "$id": "DWN/ERR_CNT_ACT#b72543bb-c405-4823-aab2-a24ebf7e8e46",
                        "$typeOfContent": "chat-state",
                        "type": "SendMessage",
                        "settings": {
                            "id": "02fec18d-29a5-44b8-8369-dbc267a30c58",
                            "type": "application/vnd.lime.chatstate+json",
                            "content": {
                                "state": "composing",
                                "interval": 1000
                            }
                        },
                        "$cardContent": {
                            "document": {
                                "id": "02fec18d-29a5-44b8-8369-dbc267a30c58",
                                "type": "application/vnd.lime.chatstate+json",
                                "content": {
                                    "state": "composing",
                                    "interval": 1000
                                }
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwnMessage",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "notEquals",
                                "variable": "dwnMessage",
                                "values": [
                                    "null"
                                ]
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "action": {
                        "$id": "DWN/ERR_CNT_ACT#b72543bb-c405-4823-aab2-a24ebf7e8e46",
                        "$typeOfContent": "text",
                        "type": "SendMessage",
                        "settings": {
                            "id": "bd5256e0-16f5-4840-a5f3-ff4c0cdc830f",
                            "type": "text/plain",
                            "content": "{{dwnMessage}}",
                            "metadata": {}
                        },
                        "$cardContent": {
                            "document": {
                                "id": "bd5256e0-16f5-4840-a5f3-ff4c0cdc830f",
                                "type": "text/plain",
                                "content": "{{dwnMessage}}"
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "exists",
                                "variable": "dwnMessage",
                                "values": []
                            },
                            {
                                "source": "context",
                                "comparison": "notEquals",
                                "variable": "dwnMessage",
                                "values": [
                                    "null"
                                ]
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "input": {
                        "bypass": true,
                        "$cardContent": {
                            "document": {
                                "id": "50f353b6-c9b5-4765-b748-059a62998220",
                                "type": "text/plain",
                                "content": "User input"
                            },
                            "editable": false,
                            "deletable": false,
                            "position": "right"
                        },
                        "$invalid": false,
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#b376da10-f44f-4101-ab57-b784d46589fd",
                    "stateId": "{{dwn@error.goto.id}}",
                    "typeOfStateId": "variable",
                    "conditions": [
                        {
                            "source": "context",
                            "comparison": "notExists",
                            "values": [],
                            "variable": "dwnError"
                        },
                        {
                            "source": "context",
                            "comparison": "notExists",
                            "values": [],
                            "variable": "dwnCore@redirect"
                        },
                        {
                            "source": "context",
                            "comparison": "exists",
                            "values": [],
                            "variable": "dwn@error"
                        },
                        {
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error.goto",
                            "values": []
                        },
                        {
                            "source": "context",
                            "comparison": "exists",
                            "values": [],
                            "variable": "dwn@error.goto.id"
                        }
                    ],
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [
                {
                    "$id": "DWN/ERR_CRT_MSG#8f2135fd-478b-4950-9cef-013266ef9c13",
                    "$typeOfContent": "",
                    "type": "ExecuteScriptV2",
                    "$title": "DWN Create Message",
                    "settings": {
                        "function": "dwnRun",
                        "source": "/**\n * @author     [Beuren Bechlin] <beuren.bechlin@dawntech.dev>\n * @version    2.0.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n *\n * ---\n *\n * This software is the proprietary property of Dawntech.\n * Possession, use, duplication, or dissemination of this software is strictly\n * prohibited unless you have received prior written permission from\n * Dawntech.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nasync function dwnRun(coreStr, errorStr) {\n  coreStr = coreStr || \"\";\n  errorStr = errorStr || \"\";\n  let message = null;\n  let core = null;\n  let error = null;\n  try {\n    core = JSON.parse(coreStr);\n    if (errorStr) {\n      error = DwnError.fromDwnError(errorStr) || null;\n    }\n    if (!error && core.error) {\n      error = DwnError.fromJson(core.error);\n    }\n    if (error && error.type !== \"PROPAGATE\") {\n      message = error.message || null;\n    }\n    if (message) {\n      message = message.trim();\n    }\n  } catch (err) {\n  }\n  return message;\n}\n/**\n * @imports\n * @version    2.0.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n */\nvar DwnError = class _DwnError extends Error {\n  /**\n   * Creates a new DwnError instance.\n   *\n   * @param {string} type The error type identifier (e.g., \"VALIDATION_ERROR\", \"SCRIPT_ERROR\")\n   * @param {string} description Human-readable description of what went wrong\n   * @param {{message?: string, messages?: string[], stack?: string, goto?: State | null, state?: State, at?: string, intent?: string | null, content?: string, recurrence?: ErrorRecurrence, code?: string | null, status?: FINALIZATION_STATUS}} [extras] Optional additional error context and metadata:\n   * - `message`: Primary error message for user display\n   * - `messages`: Array of error messages for different contexts\n   * - `stack`: Stack trace or execution context information\n   * - `goto`: Target state to redirect to on error (null means terminate)\n   * - `state`: Flow state where the error occurred\n   * - `at`: Location or context where the error occurred\n   * - `intent`: Associated intent that caused the error\n   * - `content`: Additional error content or context\n   * - `recurrence`: Information about error recurrence patterns\n   * - `code`: Error code for programmatic error handling\n   * - `status`: Finalization status indicating how the error was resolved\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid input provided\");\n   *\n   * const contextError = new DwnError(\"SCRIPT_ERROR\", \"Script execution failed\", {\n   *   state: { id: \"state-123\", service: \"main\" },\n   *   intent: \"user-input\",\n   *   content: \"invalid data\",\n   *   messages: [\"First attempt failed\", \"Retry failed\"],\n   *   goto: { id: \"error-handler\", service: \"main\" }\n   * });\n   * ```\n   */\n  constructor(type, description, extras) {\n    super();\n    this.name = \"DwnError\";\n    const _extras = _DwnError.enforceExtras(extras);\n    this.type = type;\n    this.description = description;\n    this.at = _extras.at;\n    this.content = _extras.content;\n    this.state = _extras.state;\n    this.recurrence = _extras.recurrence;\n    this.goto = _extras.goto;\n    this.message = _extras.message || undefined;\n    this.messages = _extras.messages || [];\n    this.intent = _extras.intent || undefined;\n    this.code = _extras.code || undefined;\n    this.status = _extras.status || undefined;\n    this.stack = _extras.stack || undefined;\n    if (!this.stack) {\n      if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, _DwnError);\n      }\n    }\n  }\n  /**\n   * Creates a DwnError instance from a serialized error string.\n   *\n   * Parses a DWN error string in the format \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\"\n   * and reconstructs the original DwnError instance.\n   *\n   * @param {string} dwnErrorString Serialized error string from toString() method\n   * @returns {DwnError | undefined} DwnError instance or undefined if parsing fails\n   *\n   * @example\n   * ```typescript\n   * const errorString = \"SCRIPT_ERROR -|- Execution failed -|- {...}\";\n   * const error = DwnError.fromDwnError(errorString);\n   * ```\n   */\n  static fromDwnError(dwnErrorString) {\n    if (!dwnErrorString) return undefined;\n    const parts = dwnErrorString.split(\"-|-\");\n    let type = parts.shift();\n    if (!type) {\n      return undefined;\n    }\n    type = type.trim();\n    let description = parts.shift() || \"\";\n    if (description) {\n      description = description.trim();\n    }\n    let extras = undefined;\n    try {\n      extras = JSON.parse(parts.shift() || \"{}\");\n    } catch (e) {\n    }\n    if (extras) {\n      return new _DwnError(type, description, extras);\n    }\n    return new _DwnError(type, description);\n  }\n  /**\n   * Creates a DwnError instance from a JSON object.\n   *\n   * Converts a generic Error object or JSON representation into a properly\n   * structured DwnError instance with all required properties.\n   *\n   * @param {Error} data Error object or JSON data to convert\n   * @returns {DwnError} New DwnError instance\n   *\n   * @example\n   * ```typescript\n   * const jsonData = { type: \"API_ERROR\", description: \"Request failed\" };\n   * const error = DwnError.fromJson(jsonData);\n   * ```\n   */\n  static fromJson(data) {\n    const extras = _DwnError.enforceExtras(data);\n    return new _DwnError(data.type, data.description, extras);\n  }\n  /**\n   * Normalizes and validates error extras properties.\n   *\n   * Ensures all optional properties have default values and validates the structure\n   * of the extras object. Used internally to maintain consistency across error instances.\n   *\n   * @param {DwnError | DwnErrorExtras} [entity] Error entity or extras object to normalize\n   * @returns {Required<DwnErrorExtras>} Normalized extras object with all required properties\n   *\n   * @internal\n   */\n  static enforceExtras(entity) {\n    if (!entity) entity = {};\n    const extras = {};\n    extras.message = entity.message || \"\";\n    extras.messages = entity.messages || [];\n    extras.stack = entity.stack || \"\";\n    extras.goto = entity.goto;\n    extras.state = entity.state || { id: \"\", service: \"\" };\n    extras.at = entity.at || (new Date()).toISOString();\n    extras.intent = entity.intent || \"\";\n    extras.content = entity.content || \"\";\n    extras.recurrence = entity.recurrence || { type: 1, state: 1, combined: 1 };\n    extras.code = entity.code || undefined;\n    extras.status = entity.status || undefined;\n    return extras;\n  }\n  /**\n   * Serializes the error to a string format.\n   *\n   * Converts the DwnError instance into a parseable string format using the pattern\n   * \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\" for storage or transmission.\n   *\n   * @returns {string} Serialized error string\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"API_ERROR\", \"Request failed\");\n   * const serialized = error.toString();\n   * // \"API_ERROR -|- Request failed -|- {...}\"\n   * ```\n   */\n  toString() {\n    const extras = JSON.stringify(_DwnError.enforceExtras(this));\n    return `${this.type} -|- ${this.description} -|- ${extras}`;\n  }\n  /**\n   * Converts the error to a JSON object.\n   *\n   * Serializes all error properties into a plain JavaScript object suitable\n   * for JSON serialization, API responses, or logging.\n   *\n   * @returns {Error} Plain object representation of the error\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid data\");\n   * const json = error.toJson();\n   * console.log(JSON.stringify(json, null, 2));\n   * ```\n   */\n  toJson() {\n    return {\n      type: this.type,\n      at: this.at,\n      description: this.description,\n      message: this.message,\n      messages: this.messages || [],\n      stack: this.stack || \"\",\n      intent: this.intent,\n      content: this.content,\n      goto: this.goto,\n      state: this.state,\n      recurrence: this.recurrence\n    };\n  }\n};\nvar SYSTEM_DWN_ERRORS = [\n  \"RUNTIME_ERROR\",\n  \"MISCONFIGURATION_ERROR\"\n];\n",
                        "inputVariables": [
                            "dwnCore",
                            "dwnError"
                        ],
                        "outputVariable": "dwnMessage"
                    },
                    "conditions": [],
                    "$invalid": false
                }
            ],
            "$leavingCustomActions": [
                {
                    "$id": "DWN/ERR_GOTO_RED#ebbb53c4-6562-4ac7-9a83-f138405ead3f",
                    "$typeOfContent": "",
                    "type": "Redirect",
                    "$title": "DWN Go to",
                    "settings": {
                        "address": "{{dwn@error.goto.service}}",
                        "context": {
                            "type": "text/plain",
                            "value": "{\n    \"state\": \"{{dwn@error.goto.id}}\",\n    \"service\": \"{{dwn@error.goto.service}}\",\n    \"error\": \"GOTO\"\n}"
                        }
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "notExists",
                            "variable": "dwnError"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwnCore@redirect"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwn@error.goto"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "DWN/ERR_PROP_RED#210e4dfb-4d8f-41e5-ae1e-7fd7a7bae477",
                    "$typeOfContent": "",
                    "type": "Redirect",
                    "$title": "DWN Propagate Error",
                    "settings": {
                        "address": "{{dwnCore@propagate}}",
                        "context": {
                            "type": "text/plain",
                            "value": "{\n    \"state\": \"{{dwn@error.state.id}}\",\n    \"service\": \"{{dwn@error.state.service}}\",\n    \"error\": \"PROPAGATE\"\n}"
                        }
                    },
                    "conditions": [
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwnError"
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "dwnCore@propagate"
                        }
                    ],
                    "$invalid": false
                }
            ],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "onboarding",
                "typeOfStateId": "state",
                "$invalid": false
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [],
            "id": "error",
            "$title": "DWN Error",
            "$position": {
                "top": "240px",
                "left": "877px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "bba20407-9fd4-4171-ab18-4778fffe897f": {
            "$contentActions": [
                {
                    "input": {
                        "bypass": true,
                        "$cardContent": {
                            "document": {
                                "id": "4fd765cf-686e-401b-8270-b991ac9bc6f2",
                                "type": "text/plain",
                                "textContent": "Entrada do usu√°rio",
                                "content": "Entrada do usu√°rio"
                            },
                            "editable": false,
                            "deletable": true,
                            "position": "right",
                            "editing": false
                        },
                        "$invalid": false,
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ],
                        "expiration": "00:10"
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#2503c648-ab87-4fb5-9915-f12d0ae9a06e",
                    "conditions": [
                        {
                            "comparison": "exists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ],
                    "stateId": "{{dwnCore@fallback}}",
                    "typeOfStateId": "variable",
                    "$invalid": false
                },
                {
                    "stateId": "6afc5081-bf43-4b57-84da-031af7a8d2ad",
                    "typeOfStateId": "state",
                    "$connId": "con_28",
                    "$id": "172f6941-32c7-4f9d-8fab-70bbc8395c63",
                    "conditions": [
                        {
                            "source": "context",
                            "comparison": "notExists",
                            "values": [],
                            "variable": "response"
                        }
                    ],
                    "$isBuilderDefaultOutput": true,
                    "$invalid": false
                },
                {
                    "stateId": "e485f739-cbb1-4867-9d45-cdcae4abbb09",
                    "typeOfStateId": "state",
                    "$connId": "con_33",
                    "$id": "d15cd22d-421d-4593-943f-abaaff15bb26",
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "exists",
                            "values": []
                        }
                    ],
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [
                {
                    "$id": "c8545c5a-d775-42e3-b774-5270996ee73b",
                    "$typeOfContent": "",
                    "type": "ProcessCommand",
                    "$title": "[DWNT] Deleta 'response'",
                    "settings": {
                        "to": "postmaster@msging.net",
                        "method": "delete",
                        "uri": "/contexts/{{contact.identity}}/response",
                        "variable": "responseDeleteCmdResp"
                    },
                    "conditions": [
                        {
                            "comparison": "notExists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        },
                        {
                            "values": [],
                            "source": "context",
                            "comparison": "exists",
                            "variable": "response"
                        }
                    ],
                    "$invalid": false
                },
                {
                    "$id": "d4e3baf3-47fd-4c28-be40-e3c44d1f262f",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "ProcessHttp",
                    "$title": "GET 'response'",
                    "$invalid": false,
                    "settings": {
                        "headers": {
                            "Authorization": "{{config.openAiBearer}}"
                        },
                        "method": "POST",
                        "body": "{{payloadGpt}}",
                        "uri": "{{config.openAiUrl}}/v1/responses",
                        "responseStatusVariable": "status",
                        "responseBodyVariable": "response"
                    },
                    "conditions": [
                        {
                            "comparison": "notExists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ]
                },
                {
                    "$id": "65e7196d-8afb-4de3-a13a-b8e83f6a8e9e",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "ProcessHttp",
                    "$title": "GET 'response'",
                    "$invalid": false,
                    "settings": {
                        "headers": {
                            "Authorization": "{{config.openAiBearer}}"
                        },
                        "method": "POST",
                        "body": "{{payloadGpt}}",
                        "uri": "{{config.openAiUrl}}/v1/responses",
                        "responseStatusVariable": "status",
                        "responseBodyVariable": "response"
                    },
                    "conditions": [
                        {
                            "comparison": "notExists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        },
                        {
                            "source": "context",
                            "variable": "response",
                            "comparison": "notExists",
                            "values": []
                        }
                    ]
                },
                {
                    "$id": "ec5a5276-cde6-44a1-bdfd-daeb4b2f26a1",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "ExecuteScriptV2",
                    "$title": "GET 'responseGepeto'",
                    "$invalid": false,
                    "settings": {
                        "function": "run",
                        "source": "function run(response) {\n\ttry {\n\t\tconst { output } = JSON.parse(response);\n\n\t\treturn output.find(item => item.type === \"message\").content[0].text;\n\t} catch (error) {\n\t\treturn error.message;\n\t}\n}",
                        "inputVariables": [
                            "response"
                        ],
                        "outputVariable": "responseGepeto",
                        "LocalTimeZoneEnabled": false
                    },
                    "conditions": [
                        {
                            "comparison": "notExists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        },
                        {
                            "source": "context",
                            "variable": "response",
                            "comparison": "exists",
                            "values": []
                        }
                    ]
                }
            ],
            "$leavingCustomActions": [],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "onboarding",
                "$invalid": false,
                "typeOfStateId": "state"
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [],
            "id": "bba20407-9fd4-4171-ab18-4778fffe897f",
            "root": false,
            "$title": "Integra√ß√£o GPT",
            "$position": {
                "top": "384px",
                "left": "644px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "e88becf1-e28d-4f32-9b0e-a637f76dff62": {
            "$contentActions": [
                {
                    "input": {
                        "bypass": true,
                        "$cardContent": {
                            "document": {
                                "id": "4fc90fc7-c945-4a08-8b4e-1a16ae617e89",
                                "type": "text/plain",
                                "textContent": "Entrada do usu√°rio",
                                "content": "Entrada do usu√°rio"
                            },
                            "editable": false,
                            "deletable": true,
                            "position": "right",
                            "editing": false
                        },
                        "$invalid": false,
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ],
                        "expiration": "00:10"
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#2503c648-ab87-4fb5-9915-f12d0ae9a06e",
                    "conditions": [
                        {
                            "comparison": "exists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ],
                    "stateId": "{{dwnCore@fallback}}",
                    "typeOfStateId": "variable",
                    "$invalid": false
                },
                {
                    "stateId": "bba20407-9fd4-4171-ab18-4778fffe897f",
                    "typeOfStateId": "state",
                    "$connId": "con_38",
                    "$id": "ce9a60bc-5524-4fe7-9b44-6bb18f84b91b",
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "exists",
                            "values": []
                        }
                    ],
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [
                {
                    "$id": "a51d95eb-914e-48ed-9fec-98c106e03258",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "ExecuteScriptV2",
                    "$title": "UPDATE 'payloadGpt'",
                    "$invalid": false,
                    "settings": {
                        "function": "run",
                        "source": "function run(payload, response, userInput) {\n    const DEFINITIONS = {\n        \"model\": \"o4-mini\",\n        \"firtsInput\": {\n            \"role\": \"developer\",\n            \"content\": [\n                {\n                    \"type\": \"input_text\",\n                    \"text\": \"{{resource.promptSol}}\"\n                }\n            ]\n        },\n        \"secondInput\": {\n            \"role\": \"system\",\n            \"content\": \"Responda de forma objetiva.\"\n        },\n        \"text\": {\n            \"format\": {\n                \"type\": \"text\"\n            },\n            \"verbosity\": \"medium\"\n        },\n        \"reasoning\": {\n            \"effort\": \"medium\",\n            \"summary\": \"auto\"\n        },\n        \"tools\": [\n            {\n                \"type\": \"file_search\",\n                \"vector_store_ids\": [\"{{config.vectorId}}\"]\n            }\n        ],\n        \"store\": true,\n        \"include\": [\n            \"reasoning.encrypted_content\",\n            \"web_search_call.action.sources\"\n        ]\n    }\n\n    const inputAI = userInput.includes(\"concatPayloadAI:\") ? userInput.split(\"concatPayloadAI:\")[1] : userInput;\n    try {\n        const { model, firtsInput, secondInput, text, reasoning, tools, store, include } = DEFINITIONS;\n        payload = JSON.parse(payload);\n\n        payload.model = model;\n        payload.input[0] = firtsInput;\n        payload.input[1] = secondInput;\n        payload.text = text;\n        payload.reasoning = reasoning;\n        payload.tools = tools;\n        payload.store = store;\n        payload.include = include;\n\n        const modelAssistant = {\n            \"role\": \"assistant\",\n            \"content\": [\n                {\n                    \"type\": \"output_text\",\n                    \"text\": response\n                }\n            ]\n        };\n        const modelUser = {\n            \"role\": \"user\",\n            \"content\": [\n                {\n                    \"type\": \"input_text\",\n                    \"text\": inputAI\n                }\n            ]\n        };\n\n        payload.input.push(modelAssistant, modelUser);\n\n        const MAX_INTERACTION = 30;\n        const LOWER_EDGE = (payload.input.length - MAX_INTERACTION);\n        if (payload.input.length > MAX_INTERACTION) {\n            const newPayloadInput = [payload.input[0], ...payload.input.slice(LOWER_EDGE + 1,)];\n            payload.input = newPayloadInput;\n        }\n\n        return payload;\n    } catch (error) {\n        const { model, firtsInput, secondInput, text, reasoning, tools, store, include } = DEFINITIONS;\n        return {\n            model,\n            \"input\": [\n                firtsInput,\n                secondInput,\n                {\n                    \"role\": \"user\",\n                    \"content\": [\n                        {\n                            \"type\": \"input_text\",\n                            \"text\": inputAI\n                        }\n                    ]\n                }\n            ],\n            text,\n            reasoning,\n            tools,\n            store,\n            include\n        };\n    }\n}",
                        "inputVariables": [
                            "payloadGpt",
                            "responseGepeto",
                            "firstContent"
                        ],
                        "outputVariable": "payloadGpt",
                        "LocalTimeZoneEnabled": false
                    },
                    "conditions": [
                        {
                            "comparison": "notExists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ]
                }
            ],
            "$leavingCustomActions": [],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "onboarding",
                "$invalid": false,
                "typeOfStateId": "state"
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [],
            "id": "e88becf1-e28d-4f32-9b0e-a637f76dff62",
            "root": false,
            "$title": "Anexa hist√≥rico payload",
            "$position": {
                "top": "372px",
                "left": "375px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "e485f739-cbb1-4867-9d45-cdcae4abbb09": {
            "$contentActions": [
                {
                    "action": {
                        "$id": "2bcf0030-9cf0-40a9-bb33-2da0072291a5",
                        "$typeOfContent": "chat-state",
                        "$description": "",
                        "$inputSchema": {
                            "type": "object",
                            "properties": {},
                            "required": []
                        },
                        "type": "SendMessage",
                        "settings": {
                            "id": "f86a4b83-6f69-405f-8a45-592ee8b204ab",
                            "type": "application/vnd.lime.chatstate+json",
                            "content": {
                                "state": "composing",
                                "interval": 1000
                            }
                        },
                        "$cardContent": {
                            "document": {
                                "id": "f86a4b83-6f69-405f-8a45-592ee8b204ab",
                                "type": "application/vnd.lime.chatstate+json",
                                "content": {
                                    "state": "composing",
                                    "interval": 1000
                                }
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "action": {
                        "$id": "bc32c6e7-6312-4528-a4c8-2c219c4aec49",
                        "$typeOfContent": "text",
                        "$description": "",
                        "$inputSchema": {
                            "type": "object",
                            "properties": {},
                            "required": []
                        },
                        "type": "SendMessage",
                        "settings": {
                            "id": "e202cf2e-b9db-46d2-a53a-f3c6d3b8176a",
                            "type": "text/plain",
                            "content": "{{responseGepeto}}",
                            "metadata": {}
                        },
                        "$cardContent": {
                            "document": {
                                "id": "e202cf2e-b9db-46d2-a53a-f3c6d3b8176a",
                                "type": "text/plain",
                                "content": "{{responseGepeto}}"
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "input": {
                        "bypass": true,
                        "$cardContent": {
                            "document": {
                                "id": "07510511-c7ee-43c2-b6d0-a434842ce771",
                                "type": "text/plain",
                                "textContent": "Entrada do usu√°rio",
                                "content": "Entrada do usu√°rio"
                            },
                            "editable": false,
                            "deletable": true,
                            "position": "right",
                            "editing": false
                        },
                        "$invalid": false,
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ],
                        "expiration": "00:10"
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#2503c648-ab87-4fb5-9915-f12d0ae9a06e",
                    "conditions": [
                        {
                            "comparison": "exists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ],
                    "stateId": "{{dwnCore@fallback}}",
                    "typeOfStateId": "variable",
                    "$invalid": false
                },
                {
                    "stateId": "6363a02e-58b6-42a8-87ae-b68fad85c65c",
                    "typeOfStateId": "state",
                    "$connId": "con_43",
                    "$id": "fad36071-5395-4d99-b542-e471ac65f41c",
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "exists",
                            "values": []
                        }
                    ],
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [],
            "$leavingCustomActions": [
                {
                    "$id": "6e8c6338-b41a-4581-acc5-57267237a759",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "TrackEvent",
                    "$title": "interaction-ai-faq",
                    "$invalid": false,
                    "settings": {
                        "extras": {},
                        "category": "interaction-ai-faq",
                        "action": "{{firstContent}} | {{responseGepeto}}"
                    },
                    "conditions": [
                        {
                            "source": "context",
                            "comparison": "exists",
                            "values": [],
                            "variable": "firstContent"
                        },
                        {
                            "source": "context",
                            "comparison": "exists",
                            "values": [],
                            "variable": "responseGepeto"
                        }
                    ]
                },
                {
                    "$id": "7c7ef8f1-abd4-49a8-8733-22b592bdb4ec",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "TrackEvent",
                    "$title": "interaction-ai-faq-user",
                    "$invalid": false,
                    "settings": {
                        "extras": {},
                        "category": "interaction-ai-faq-user",
                        "action": "{{contact.name}} | {{contact.identity}} | {{firstContent}} | {{responseGepeto}}"
                    },
                    "conditions": [
                        {
                            "source": "context",
                            "comparison": "exists",
                            "values": [],
                            "variable": "firstContent"
                        },
                        {
                            "source": "context",
                            "comparison": "exists",
                            "values": [],
                            "variable": "responseGepeto"
                        }
                    ]
                }
            ],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "fallback",
                "$invalid": false
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [],
            "id": "e485f739-cbb1-4867-9d45-cdcae4abbb09",
            "root": false,
            "$title": "Resposta GPT",
            "$position": {
                "top": "517px",
                "left": "644px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "DWN/TAGS_BLK#44496c10-7d83-4e06-93b8-22c7b26789fb": {
            "id": "DWN/TAGS_BLK#44496c10-7d83-4e06-93b8-22c7b26789fb",
            "$title": "DWN Tags",
            "$contentActions": [],
            "$conditionOutputs": [],
            "$enteringCustomActions": [],
            "$leavingCustomActions": [],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "fallback",
                "$invalid": false
            },
            "$tags": [
                {
                    "background": "#FFFF00",
                    "label": "DWN - Disable Error",
                    "id": "DWN/TAG_DIS_ERR#9c457030-3296-4370-829d-f428641750e4",
                    "canChangeBackground": false
                },
                {
                    "background": "#FF0000",
                    "label": "DWN - Error",
                    "id": "DWN/TAG_ERR#16871d75-ce98-44e3-bf61-64c9a764ebb9",
                    "canChangeBackground": false
                },
                {
                    "background": "#FF8000",
                    "label": "DWN - Prepare",
                    "id": "DWN/TAG_PREP#aa459da7-ffa4-47c8-8487-6295b8f01d32",
                    "canChangeBackground": false
                },
                {
                    "background": "#0000FF",
                    "label": "DWN - Reset",
                    "id": "DWN/TAG_RST#978a9c38-c025-4181-9bbd-966ff8ff9bb0",
                    "canChangeBackground": false
                },
                {
                    "background": "#FF00FF",
                    "label": "DWN - Custom Expiration",
                    "id": "DWN/TAG_CUST_EXP#ef8eaf43-f10b-470d-be3e-58b6fa87c39a",
                    "canChangeBackground": false
                },
                {
                    "background": "#00FFFF",
                    "label": "DWN - Redirect",
                    "id": "DWN/TAG_RED#ac020f84-3722-47eb-8250-3845d1af6d86",
                    "canChangeBackground": false
                },
                {
                    "background": "#8B00FF",
                    "label": "DWN - Input",
                    "id": "DWN/TAG_INP#ec687a82-cfa6-4f64-acae-0ed4e6209764",
                    "canChangeBackground": false
                },
                {
                    "background": "#00FF00",
                    "label": "DWN - Merge Contact",
                    "id": "DWN/TAG_MRG_CNT#75550d25-28a5-43f4-b509-3306608554fa",
                    "canChangeBackground": false
                },
                {
                    "background": "#0080FF",
                    "label": "DWN - Track Events",
                    "id": "DWN/TAG_TRK_EVT#c9ac2aa2-f775-44ee-bd9a-ab6da9d7c548",
                    "canChangeBackground": false
                }
            ],
            "$position": {
                "top": "10000px",
                "left": "10000px"
            },
            "root": false,
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "b98e06c1-9584-4544-a7c6-edc8ba90bbed": {
            "$contentActions": [
                {
                    "input": {
                        "bypass": true,
                        "$cardContent": {
                            "document": {
                                "id": "aa03617f-790d-4884-b01a-738463dea0b6",
                                "type": "text/plain",
                                "textContent": "Entrada do usu√°rio",
                                "content": "Entrada do usu√°rio"
                            },
                            "editable": false,
                            "deletable": true,
                            "position": "right",
                            "editing": false
                        },
                        "$invalid": false,
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ],
                        "expiration": "00:10"
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#b495716e-da52-4f75-a88e-839b6a3bc992",
                    "conditions": [
                        {
                            "comparison": "exists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ],
                    "stateId": "{{dwnCore@fallback}}",
                    "typeOfStateId": "variable",
                    "$invalid": false
                },
                {
                    "stateId": "9520a975-50a2-4e9f-8993-9ebe98fbc9e1",
                    "typeOfStateId": "state",
                    "$connId": "con_48",
                    "$id": "211b6063-880c-4da8-bac6-efe13d70686a",
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "equals",
                            "values": [
                                "#hml:reset",
                                "#reset"
                            ]
                        }
                    ],
                    "$isBuilderDefaultOutput": true,
                    "$invalid": false
                },
                {
                    "stateId": "5db7f064-a288-4a9e-9c63-435e639e0060",
                    "typeOfStateId": "state",
                    "$connId": "con_53",
                    "$id": "d5ed6a0f-fa1d-4859-9ba5-26d8c2bfa4e3",
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "equals",
                            "values": [
                                "#menu",
                                "menu"
                            ]
                        }
                    ],
                    "$isBuilderDefaultOutput": true,
                    "$invalid": false
                },
                {
                    "stateId": "159fffe3-685b-4678-9874-db9ebee2f5e2",
                    "typeOfStateId": "state",
                    "$connId": "con_58",
                    "$id": "28314323-b280-4b13-ad4f-5c3a1ce19dde",
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "exists",
                            "values": []
                        }
                    ],
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [],
            "$leavingCustomActions": [],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "fallback",
                "$invalid": false
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [],
            "id": "b98e06c1-9584-4544-a7c6-edc8ba90bbed",
            "root": false,
            "$title": "[Valida] Input pular AI",
            "$position": {
                "top": "806px",
                "left": "643px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "5db7f064-a288-4a9e-9c63-435e639e0060": {
            "$contentActions": [
                {
                    "input": {
                        "bypass": true,
                        "$cardContent": {
                            "document": {
                                "id": "7ef73e1f-4f8c-437d-bcaf-85efab430985",
                                "type": "text/plain",
                                "textContent": "Entrada do usu√°rio",
                                "content": "Entrada do usu√°rio"
                            },
                            "editable": false,
                            "deletable": true,
                            "position": "right",
                            "editing": false
                        },
                        "$invalid": false,
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ],
                        "expiration": "00:10"
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#b495716e-da52-4f75-a88e-839b6a3bc992",
                    "conditions": [
                        {
                            "comparison": "exists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ],
                    "stateId": "{{dwnCore@fallback}}",
                    "typeOfStateId": "variable",
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [
                {
                    "$id": "d8c7580f-6e9e-4bfd-be31-17406ff992c8",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "Redirect",
                    "$title": "Redirecionar a um servi√ßo",
                    "$invalid": false,
                    "settings": {
                        "context": {
                            "type": "text/plain",
                            "value": "cameFrom_aifaq_menu"
                        },
                        "address": "Main"
                    },
                    "conditions": [
                        {
                            "comparison": "notExists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ]
                }
            ],
            "$leavingCustomActions": [],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "onboarding",
                "$invalid": false,
                "typeOfStateId": "state"
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [
                {
                    "background": "#00FFFF",
                    "label": "DWN - Redirect",
                    "id": "DWN/TAG_RED#ac020f84-3722-47eb-8250-3845d1af6d86",
                    "canChangeBackground": false
                }
            ],
            "id": "5db7f064-a288-4a9e-9c63-435e639e0060",
            "root": false,
            "$title": "[Redirect] Main - Menu",
            "$position": {
                "top": "794px",
                "left": "905px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "d52c8170-9a73-4b25-b0e3-a2700f87673c": {
            "$contentActions": [
                {
                    "input": {
                        "bypass": true,
                        "$cardContent": {
                            "document": {
                                "id": "f6b68330-870e-4bff-b867-3de59b232255",
                                "type": "text/plain",
                                "textContent": "Entrada do usu√°rio",
                                "content": "Entrada do usu√°rio"
                            },
                            "editable": false,
                            "deletable": true,
                            "position": "right",
                            "editing": false
                        },
                        "$invalid": false,
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ],
                        "expiration": "00:10"
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#b495716e-da52-4f75-a88e-839b6a3bc992",
                    "conditions": [
                        {
                            "comparison": "exists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ],
                    "stateId": "{{dwnCore@fallback}}",
                    "typeOfStateId": "variable",
                    "$invalid": false
                },
                {
                    "stateId": "bba20407-9fd4-4171-ab18-4778fffe897f",
                    "typeOfStateId": "state",
                    "$connId": "con_63",
                    "$id": "335d4bcd-5ecf-4117-9f85-9d57c04efdc0",
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "exists",
                            "values": []
                        }
                    ],
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [
                {
                    "$id": "ad8a51c7-13dc-4ef2-a15d-fd7d95ae669d",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "ExecuteScriptV2",
                    "$title": "SET 'payloadGpt'",
                    "$invalid": false,
                    "settings": {
                        "function": "run",
                        "source": "function run() {\n    return {\n        \"model\": \"o4-mini\",\n        \"input\": [\n            {\n                \"role\": \"developer\",\n                \"content\": [\n                    {\n                        \"type\": \"input_text\",\n                        \"text\": \"{{resource.promptSol}}\"\n                    }\n                ]\n            },\n            {\n                \"role\": \"system\",\n                \"content\": \"Responda de forma objetiva.\"\n            },\n            {\n                \"role\": \"user\",\n                \"content\": [\n                    {\n                        \"type\": \"input_text\",\n                        \"text\": \"{{firstContent}}\"\n                    }\n                ]\n            }\n        ],\n        \"text\": {\n            \"format\": {\n                \"type\": \"text\"\n            },\n            \"verbosity\": \"medium\"\n        },\n        \"reasoning\": {\n            \"effort\": \"medium\",\n            \"summary\": \"auto\"\n        },\n        \"tools\": [\n            {\n                \"type\": \"file_search\",\n                \"vector_store_ids\": [\"{{config.vectorId}}\"]\n            }\n        ],\n        \"store\": true,\n        \"include\": [\n            \"reasoning.encrypted_content\",\n            \"web_search_call.action.sources\"\n        ]\n    }\n}",
                        "inputVariables": [],
                        "outputVariable": "payloadGpt",
                        "LocalTimeZoneEnabled": false
                    },
                    "conditions": [
                        {
                            "comparison": "notExists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ]
                }
            ],
            "$leavingCustomActions": [],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "fallback",
                "$invalid": false
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [],
            "id": "d52c8170-9a73-4b25-b0e3-a2700f87673c",
            "root": false,
            "$title": "Prepara payload inicial",
            "$position": {
                "top": "234px",
                "left": "644px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "6363a02e-58b6-42a8-87ae-b68fad85c65c": {
            "$contentActions": [
                {
                    "input": {
                        "bypass": false,
                        "$cardContent": {
                            "document": {
                                "id": "55ab75ba-afef-4535-b6df-232a433b855e",
                                "type": "text/plain",
                                "textContent": "Entrada do usu√°rio",
                                "content": "Entrada do usu√°rio"
                            },
                            "editable": false,
                            "deletable": true,
                            "position": "right",
                            "editing": false
                        },
                        "$invalid": false,
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ],
                        "expiration": "0:10"
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#b495716e-da52-4f75-a88e-839b6a3bc992",
                    "conditions": [
                        {
                            "comparison": "exists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ],
                    "stateId": "{{dwnCore@fallback}}",
                    "typeOfStateId": "variable",
                    "$invalid": false
                },
                {
                    "stateId": "b98e06c1-9584-4544-a7c6-edc8ba90bbed",
                    "typeOfStateId": "state",
                    "$connId": "con_68",
                    "$id": "0eb3c8b9-97ea-4648-8714-700f32a15d34",
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "exists",
                            "values": []
                        }
                    ],
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [],
            "$leavingCustomActions": [
                {
                    "$id": "ea4cf3de-313a-4e2c-a465-6daed4d5bf60",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "SetVariable",
                    "$title": "SET 'inputAI'",
                    "$invalid": false,
                    "settings": {
                        "variable": "inputAI",
                        "value": "{{input.content}}"
                    },
                    "conditions": [
                        {
                            "comparison": "notExists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ]
                },
                {
                    "$id": "a41d6236-644f-48a9-89c8-8f197fe2872e",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "TrackEvent",
                    "$title": "input-ai-faq",
                    "$invalid": false,
                    "settings": {
                        "extras": {},
                        "category": "input-ai-faq",
                        "action": "{{input.content}}"
                    },
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "exists",
                            "values": []
                        }
                    ]
                },
                {
                    "$id": "e3ef1c26-36f9-4aca-bb85-f7ebd9388854",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "TrackEvent",
                    "$title": "input-ai-faq-user",
                    "$invalid": false,
                    "settings": {
                        "extras": {},
                        "category": "input-ai-faq-user",
                        "action": "{{contact.name}} | {{contact.identity}} | {{input.content}}"
                    },
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "exists",
                            "values": []
                        }
                    ]
                }
            ],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "fallback",
                "$invalid": false
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [
                {
                    "background": "#8B00FF",
                    "label": "DWN - Input",
                    "id": "DWN/TAG_INP#ec687a82-cfa6-4f64-acae-0ed4e6209764",
                    "canChangeBackground": false
                }
            ],
            "id": "6363a02e-58b6-42a8-87ae-b68fad85c65c",
            "root": false,
            "$title": "Aguarda novo input",
            "$position": {
                "top": "644px",
                "left": "644px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "159fffe3-685b-4678-9874-db9ebee2f5e2": {
            "$contentActions": [
                {
                    "input": {
                        "bypass": true,
                        "$cardContent": {
                            "document": {
                                "id": "d2216eee-e63c-4b5c-94c6-3eb9dce65a43",
                                "type": "text/plain",
                                "textContent": "Entrada do usu√°rio",
                                "content": "Entrada do usu√°rio"
                            },
                            "editable": false,
                            "deletable": true,
                            "position": "right",
                            "editing": false
                        },
                        "$invalid": false,
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ],
                        "expiration": "00:10"
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#b495716e-da52-4f75-a88e-839b6a3bc992",
                    "conditions": [
                        {
                            "comparison": "exists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ],
                    "stateId": "{{dwnCore@fallback}}",
                    "typeOfStateId": "variable",
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [
                {
                    "$id": "59226148-a53b-439a-be2e-f88e8baae73e",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "Redirect",
                    "$title": "Redirecionar a um servi√ßo",
                    "$invalid": false,
                    "settings": {
                        "context": {
                            "type": "text/plain",
                            "value": "cameFrom_aifaq_regexIntent:{{inputAI}}"
                        },
                        "address": "Main"
                    },
                    "conditions": [
                        {
                            "comparison": "notExists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ]
                }
            ],
            "$leavingCustomActions": [],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "onboarding",
                "$invalid": false,
                "typeOfStateId": "state"
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [
                {
                    "background": "#00FFFF",
                    "label": "DWN - Redirect",
                    "id": "DWN/TAG_RED#ac020f84-3722-47eb-8250-3845d1af6d86",
                    "canChangeBackground": false
                }
            ],
            "id": "159fffe3-685b-4678-9874-db9ebee2f5e2",
            "root": false,
            "$title": "[Redirect] Valida Regex intent",
            "$position": {
                "top": "956px",
                "left": "644px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "6afc5081-bf43-4b57-84da-031af7a8d2ad": {
            "$contentActions": [
                {
                    "action": {
                        "$id": "3ec0f980-bf7b-4854-8ab1-ed4853a430af",
                        "$typeOfContent": "chat-state",
                        "$description": "",
                        "$inputSchema": {
                            "type": "object",
                            "properties": {},
                            "required": []
                        },
                        "type": "SendMessage",
                        "settings": {
                            "id": "6800468e-eb58-482a-bc0b-34db0e46ef8f",
                            "type": "application/vnd.lime.chatstate+json",
                            "content": {
                                "state": "composing",
                                "interval": 1000
                            }
                        },
                        "$cardContent": {
                            "document": {
                                "id": "6800468e-eb58-482a-bc0b-34db0e46ef8f",
                                "type": "application/vnd.lime.chatstate+json",
                                "content": {
                                    "state": "composing",
                                    "interval": 1000
                                }
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "action": {
                        "$id": "d3af4a49-1377-48f4-b7e9-a9e1c5370f81",
                        "$typeOfContent": "text",
                        "$description": "",
                        "$inputSchema": {
                            "type": "object",
                            "properties": {},
                            "required": []
                        },
                        "type": "SendMessage",
                        "settings": {
                            "id": "1ebfe14e-f849-47bb-aa08-700d0bcc8769",
                            "type": "text/plain",
                            "content": "Ops! Acho que me atrapalhei aqui e n√£o consegui responder sua pergunta üòÖ\nPode me enviar novamente?",
                            "metadata": {}
                        },
                        "$cardContent": {
                            "document": {
                                "id": "1ebfe14e-f849-47bb-aa08-700d0bcc8769",
                                "type": "text/plain",
                                "content": "Ops! Acho que me atrapalhei aqui e n√£o consegui responder sua pergunta üòÖ\nPode me enviar novamente?"
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "input": {
                        "bypass": true,
                        "$cardContent": {
                            "document": {
                                "id": "d79ac01c-211c-41ee-9b68-9841b71c7fe1",
                                "type": "text/plain",
                                "textContent": "Entrada do usu√°rio",
                                "content": "Entrada do usu√°rio"
                            },
                            "editable": false,
                            "deletable": true,
                            "position": "right",
                            "editing": false
                        },
                        "$invalid": false,
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ],
                        "expiration": "00:10"
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#b495716e-da52-4f75-a88e-839b6a3bc992",
                    "conditions": [
                        {
                            "comparison": "exists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ],
                    "stateId": "{{dwnCore@fallback}}",
                    "typeOfStateId": "variable",
                    "$invalid": false
                },
                {
                    "stateId": "6363a02e-58b6-42a8-87ae-b68fad85c65c",
                    "typeOfStateId": "state",
                    "$connId": "con_73",
                    "$id": "93d79952-3862-4ced-b093-197e9dab6382",
                    "conditions": [
                        {
                            "source": "input",
                            "comparison": "exists",
                            "values": []
                        }
                    ],
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [
                {
                    "$id": "b569fe8c-f88c-41cd-a40f-6d55c184a820",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "TrackEvent",
                    "$title": "openai-error-request",
                    "$invalid": false,
                    "settings": {
                        "extras": {},
                        "category": "openai-error-request",
                        "action": "{{contact.identity}} | {{firstContent}}"
                    },
                    "conditions": []
                }
            ],
            "$leavingCustomActions": [],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "fallback",
                "$invalid": false
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [],
            "id": "6afc5081-bf43-4b57-84da-031af7a8d2ad",
            "root": false,
            "$title": "Repetir pergunta",
            "$position": {
                "top": "514px",
                "left": "900px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        },
        "9520a975-50a2-4e9f-8993-9ebe98fbc9e1": {
            "$contentActions": [
                {
                    "action": {
                        "$id": "17a21144-4634-4f68-8c2f-5a938dc92b67",
                        "$typeOfContent": "chat-state",
                        "$description": "",
                        "$inputSchema": {
                            "type": "object",
                            "properties": {},
                            "required": []
                        },
                        "type": "SendMessage",
                        "settings": {
                            "id": "a4b8f86c-ed44-48da-808f-a221b3e0c6f6",
                            "type": "application/vnd.lime.chatstate+json",
                            "content": {
                                "state": "composing",
                                "interval": 1000
                            }
                        },
                        "$cardContent": {
                            "document": {
                                "id": "a4b8f86c-ed44-48da-808f-a221b3e0c6f6",
                                "type": "application/vnd.lime.chatstate+json",
                                "content": {
                                    "state": "composing",
                                    "interval": 1000
                                }
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "action": {
                        "$id": "1f875658-ade6-4dd2-a68d-84082eeab2a8",
                        "$typeOfContent": "text",
                        "$description": "",
                        "$inputSchema": {
                            "type": "object",
                            "properties": {},
                            "required": []
                        },
                        "type": "SendMessage",
                        "settings": {
                            "id": "d32979ab-ef49-4b1b-8470-d09d352b7758",
                            "type": "text/plain",
                            "content": "Resetando hist√≥rico..\n\nEnvie uma nova mensagem",
                            "metadata": {}
                        },
                        "$cardContent": {
                            "document": {
                                "id": "d32979ab-ef49-4b1b-8470-d09d352b7758",
                                "type": "text/plain",
                                "content": "Resetando hist√≥rico..\n\nEnvie uma nova mensagem"
                            },
                            "editable": true,
                            "deletable": true,
                            "position": "left"
                        },
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ]
                    },
                    "$invalid": false
                },
                {
                    "input": {
                        "bypass": false,
                        "$cardContent": {
                            "document": {
                                "id": "b19bf626-6b07-4380-8b74-653ab1ba6278",
                                "type": "text/plain",
                                "textContent": "Entrada do usu√°rio",
                                "content": "Entrada do usu√°rio"
                            },
                            "editable": false,
                            "deletable": true,
                            "position": "right",
                            "editing": false
                        },
                        "$invalid": false,
                        "conditions": [
                            {
                                "comparison": "notExists",
                                "source": "context",
                                "variable": "dwnError",
                                "values": []
                            }
                        ],
                        "expiration": "00:10"
                    },
                    "$invalid": false
                }
            ],
            "$conditionOutputs": [
                {
                    "$id": "DWN/ERR_COND#b495716e-da52-4f75-a88e-839b6a3bc992",
                    "conditions": [
                        {
                            "comparison": "exists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ],
                    "stateId": "{{dwnCore@fallback}}",
                    "typeOfStateId": "variable",
                    "$invalid": false
                }
            ],
            "$enteringCustomActions": [],
            "$leavingCustomActions": [
                {
                    "$id": "0f31abfd-fd23-4c49-8b7c-172973cc30c2",
                    "$typeOfContent": "",
                    "$description": "",
                    "$inputSchema": {
                        "type": "object",
                        "properties": {},
                        "required": []
                    },
                    "type": "SetVariable",
                    "$title": "SET 'firstContent'",
                    "$invalid": false,
                    "settings": {
                        "variable": "firstContent",
                        "value": "{{input.content}}"
                    },
                    "conditions": [
                        {
                            "comparison": "notExists",
                            "source": "context",
                            "variable": "dwnError",
                            "values": []
                        }
                    ]
                }
            ],
            "$inputSuggestions": [],
            "$defaultOutput": {
                "stateId": "d52c8170-9a73-4b25-b0e3-a2700f87673c",
                "$invalid": false,
                "typeOfStateId": "state"
            },
            "$localCustomActions": [],
            "isAiGenerated": false,
            "$tags": [
                {
                    "background": "#8B00FF",
                    "label": "DWN - Input",
                    "id": "DWN/TAG_INP#ec687a82-cfa6-4f64-acae-0ed4e6209764",
                    "canChangeBackground": false
                }
            ],
            "id": "9520a975-50a2-4e9f-8993-9ebe98fbc9e1",
            "root": false,
            "$title": "Reset context",
            "$position": {
                "top": "806px",
                "left": "391px"
            },
            "$invalidContentActions": false,
            "$invalidOutputs": false,
            "$invalidCustomActions": false,
            "$invalid": false
        }
    },
    "globalActions": {
        "$contentActions": [],
        "$conditionOutputs": [],
        "$enteringCustomActions": [
            {
                "$id": "DWN/GLB_CFG_SCT#a46aaab2-85b4-4cf7-a283-068e8b3ac596",
                "$typeOfContent": "",
                "type": "ExecuteScriptV2",
                "$title": "DWN [SETTINGS] Config",
                "settings": {
                    "function": "dwnRun",
                    "source": "\nvar DEFAULT_LIST = {\n  block: false,\n  allow: false\n};\nvar DEFAULT_THRESHOLD = {\n  minScore: 0.75,\n  maxStack: 3\n};\nvar DEFAULT_DISABLE = {\n  inactivity: false,\n  intents: []\n};\nvar DEFAULT_STACK_SIZES = {\n  requests: 3,\n  logs: 10,\n  intents: 3,\n  errors: 5,\n  checkpoints: 5\n};\nvar DEFAULT_GLOBAL_INTENTS = [\n  {\n    id: \"CLOSE\",\n    label: \"Sair\",\n    type: \"regex\",\n    patterns: [\"#sair\", \"sair\", \"encerrar\"],\n    goto: null\n  },\n  {\n    id: \"CHECKPOINT_BACK\",\n    label: \"Voltar\",\n    type: \"regex\",\n    patterns: [\"voltar\"]\n  }\n];\nvar DEFAULT_GREETING = {\n  [\"MORNING\"]: \"Bom dia\",\n  [\"AFTERNOON\"]: \"Boa tarde\",\n  [\"EVENING\"]: \"Boa noite\",\n  [\"NIGHT\"]: \"Boa noite\"\n};\nvar DEFAULT_ERROR_MESSAGES = {\n  [\"UNEXPECTED_INPUT\"]: [\n    \"Desculpe, n√£o consegui entender.\\n\\n<b>Escolha uma op√ß√£o do menu ou tente com outras palavras,</b> por favor.\",\n    \"N√£o entendi o que voc√™ quis dizer.\\n\\n<b>Poderia tentar novamente?</b>\"\n  ],\n  [\"UNEXPECTED_OPTION\"]: [\n    \"N√£o entendi sua mensagem, desculpe...\\n\\n<b>Confira as op√ß√µes do menu e escolha uma,</b> por favor.\",\n    \"Essa n√£o √© uma das op√ß√µes...\\n\\n<b>Confira as op√ß√µes do menu e escolha uma,</b> por favor.\"\n  ],\n  [\"INACTIVITY\"]: [\n    //\"J√° faz uns minutinhos desde a sua √∫ltima mensagem...\",\n    \"Quando quiser retomar a conversa, √© s√≥ me chamar. Estou por aqui para te ajudar!\"\n  ],\n  [\"HTTP_ERROR\"]: [\n    \"Desculpe, meu sistema est√° indispon√≠vel agora...\\n\\n<b>Por favor, tente novamente mais tarde.</b>\"\n  ],\n  [\"SCRIPT_ERROR\"]: [\n    \"Desculpe, n√£o consigo te ajudar nesse momento...\\n\\n<b>Por favor, tente novamente mais tarde.</b>\"\n  ],\n  [\"RECURRENT_ERROR\"]: [\n    \"Ainda n√£o estou conseguindo te entender...\\n\\n<i>‚ÑπÔ∏è Caso esteja com dificuldades no WhatsApp, busque nossos outros canais de atendimento.</i>\\n\\n<b>Seu atendimento ser√° encerrado, mas voc√™ pode reiniciar a qualquer momento mandando um ‚Äúoi‚Äù.</b>\"\n  ]\n};\nvar DEFAULT_TYPE_MESSAGES = {\n  [\"AUDIO\"]: [\n    \"N√£o consigo ouvir √°udios agora...\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\",\n    \"Opa, n√£o posso ouvir √°udios agora! üîàüö´\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\"\n  ],\n  [\"VIDEO\"]: [\n    \"N√£o consigo ver v√≠deos agora...\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\",\n    \"Opa, n√£o posso ver v√≠deos agora... üé•üö´\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\"\n  ],\n  [\"IMAGE\"]: [\n    \"N√£o consigo ver imagens agora...\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\",\n    \"Opa, n√£o posso ver imagens agora... üñºüö´\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\"\n  ],\n  [\"STICKER\"]: [\n    \"N√£o consigo ver figurinhas...\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\",\n    \"Opa, n√£o posso ver figurinhas... üñºüö´\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\"\n  ],\n  [\"DOCUMENT\"]: [\n    \"N√£o consigo ver arquivos agora...\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\",\n    \"Opa, n√£o posso ver arquivos agora... üìÑüö´\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\"\n  ],\n  [\"LOCATION\"]: [\n    \"N√£o consigo ver a localiza√ß√£o agora...\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\",\n    \"Opa, n√£o posso ver a localiza√ß√£o agora... üìçüö´\\n\\n<b>Envie apenas texto ou uma das op√ß√µes do menu, por favor.</b>\"\n  ]\n};\nvar DEFAULT_INTENT_MESSAGES = {\n  [\"CLOSE\"]: [\n    \"Obrigado por nos contatar! üòä Se precisar de mais ajuda, n√£o hesite em nos procurar novamente.\"\n  ]\n};\nvar DEFAULT_ERROR = {\n  default: \"UNEXPECTED_INPUT\",\n  inactivity: \"INACTIVITY\"\n};\nvar DEFAULT_DAYPARTS = {\n  [\"MORNING\"]: [6, 7, 8, 9, 10, 11],\n  [\"AFTERNOON\"]: [12, 13, 14, 15, 16, 17],\n  [\"EVENING\"]: [18, 19, 20, 21],\n  [\"NIGHT\"]: [22, 23, 0, 1, 2, 3, 4, 5]\n};\nvar DEFAULT_LABEL = {\n  [\"UNEXPECTED\"]: \"Inesperado\",\n  [\"ABANDONED\"]: \"Abandonado\",\n  [\"RESOLVED\"]: \"Finalizado\",\n  [\"ERROR\"]: \"Erro\"\n};\nvar DEFAULT_PASSWORD = \"admin\";\nvar DEFAULT_PROPAGATE = \"Main\";\nvar DEFAULT_CONTACT_GROUPS = [1];\nvar DEFAULT_DEBUG = false;\nasync function dwnRun(stateId, errorStr, setupStr) {\n  let config = {\n    ...await process(stateId, errorStr, setupStr)\n    // Define your custom config here\n  };\n  return JSON.stringify(config);\n}\n/**\n * @imports\n * @version    1.1.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n */\nvar DwnError = class _DwnError extends Error {\n  /**\n   * Creates a new DwnError instance.\n   *\n   * @param {string} type The error type identifier (e.g., \"VALIDATION_ERROR\", \"SCRIPT_ERROR\")\n   * @param {string} description Human-readable description of what went wrong\n   * @param {{message?: string, messages?: string[], stack?: string, goto?: State | null, state?: State, at?: string, intent?: string | null, content?: string, recurrence?: ErrorRecurrence, code?: string | null, status?: FINALIZATION_STATUS}} [extras] Optional additional error context and metadata:\n   * - `message`: Primary error message for user display\n   * - `messages`: Array of error messages for different contexts\n   * - `stack`: Stack trace or execution context information\n   * - `goto`: Target state to redirect to on error (null means terminate)\n   * - `state`: Flow state where the error occurred\n   * - `at`: Location or context where the error occurred\n   * - `intent`: Associated intent that caused the error\n   * - `content`: Additional error content or context\n   * - `recurrence`: Information about error recurrence patterns\n   * - `code`: Error code for programmatic error handling\n   * - `status`: Finalization status indicating how the error was resolved\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid input provided\");\n   *\n   * const contextError = new DwnError(\"SCRIPT_ERROR\", \"Script execution failed\", {\n   *   state: { id: \"state-123\", service: \"main\" },\n   *   intent: \"user-input\",\n   *   content: \"invalid data\",\n   *   messages: [\"First attempt failed\", \"Retry failed\"],\n   *   goto: { id: \"error-handler\", service: \"main\" }\n   * });\n   * ```\n   */\n  constructor(type, description, extras) {\n    super();\n    this.name = \"DwnError\";\n    const _extras = _DwnError.enforceExtras(extras);\n    this.type = type;\n    this.description = description;\n    this.at = _extras.at;\n    this.content = _extras.content;\n    this.state = _extras.state;\n    this.recurrence = _extras.recurrence;\n    this.goto = _extras.goto;\n    this.message = _extras.message || undefined;\n    this.messages = _extras.messages || [];\n    this.intent = _extras.intent || undefined;\n    this.code = _extras.code || undefined;\n    this.status = _extras.status || undefined;\n    this.stack = _extras.stack || undefined;\n    if (!this.stack) {\n      if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, _DwnError);\n      }\n    }\n  }\n  /**\n   * Creates a DwnError instance from a serialized error string.\n   *\n   * Parses a DWN error string in the format \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\"\n   * and reconstructs the original DwnError instance.\n   *\n   * @param {string} dwnErrorString Serialized error string from toString() method\n   * @returns {DwnError | undefined} DwnError instance or undefined if parsing fails\n   *\n   * @example\n   * ```typescript\n   * const errorString = \"SCRIPT_ERROR -|- Execution failed -|- {...}\";\n   * const error = DwnError.fromDwnError(errorString);\n   * ```\n   */\n  static fromDwnError(dwnErrorString) {\n    if (!dwnErrorString) return undefined;\n    const parts = dwnErrorString.split(\"-|-\");\n    let type = parts.shift();\n    if (!type) {\n      return undefined;\n    }\n    type = type.trim();\n    let description = parts.shift() || \"\";\n    if (description) {\n      description = description.trim();\n    }\n    let extras = undefined;\n    try {\n      extras = JSON.parse(parts.shift() || \"{}\");\n    } catch (e) {\n    }\n    if (extras) {\n      return new _DwnError(type, description, extras);\n    }\n    return new _DwnError(type, description);\n  }\n  /**\n   * Creates a DwnError instance from a JSON object.\n   *\n   * Converts a generic Error object or JSON representation into a properly\n   * structured DwnError instance with all required properties.\n   *\n   * @param {Error} data Error object or JSON data to convert\n   * @returns {DwnError} New DwnError instance\n   *\n   * @example\n   * ```typescript\n   * const jsonData = { type: \"API_ERROR\", description: \"Request failed\" };\n   * const error = DwnError.fromJson(jsonData);\n   * ```\n   */\n  static fromJson(data) {\n    const extras = _DwnError.enforceExtras(data);\n    return new _DwnError(data.type, data.description, extras);\n  }\n  /**\n   * Normalizes and validates error extras properties.\n   *\n   * Ensures all optional properties have default values and validates the structure\n   * of the extras object. Used internally to maintain consistency across error instances.\n   *\n   * @param {DwnError | DwnErrorExtras} [entity] Error entity or extras object to normalize\n   * @returns {Required<DwnErrorExtras>} Normalized extras object with all required properties\n   *\n   * @internal\n   */\n  static enforceExtras(entity) {\n    if (!entity) entity = {};\n    const extras = {};\n    extras.message = entity.message || \"\";\n    extras.messages = entity.messages || [];\n    extras.stack = entity.stack || \"\";\n    extras.goto = entity.goto;\n    extras.state = entity.state || { id: \"\", service: \"\" };\n    extras.at = entity.at || (new Date()).toISOString();\n    extras.intent = entity.intent || \"\";\n    extras.content = entity.content || \"\";\n    extras.recurrence = entity.recurrence || { type: 1, state: 1, combined: 1 };\n    extras.code = entity.code || undefined;\n    extras.status = entity.status || undefined;\n    return extras;\n  }\n  /**\n   * Serializes the error to a string format.\n   *\n   * Converts the DwnError instance into a parseable string format using the pattern\n   * \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\" for storage or transmission.\n   *\n   * @returns {string} Serialized error string\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"API_ERROR\", \"Request failed\");\n   * const serialized = error.toString();\n   * // \"API_ERROR -|- Request failed -|- {...}\"\n   * ```\n   */\n  toString() {\n    const extras = JSON.stringify(_DwnError.enforceExtras(this));\n    return `${this.type} -|- ${this.description} -|- ${extras}`;\n  }\n  /**\n   * Converts the error to a JSON object.\n   *\n   * Serializes all error properties into a plain JavaScript object suitable\n   * for JSON serialization, API responses, or logging.\n   *\n   * @returns {Error} Plain object representation of the error\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid data\");\n   * const json = error.toJson();\n   * console.log(JSON.stringify(json, null, 2));\n   * ```\n   */\n  toJson() {\n    return {\n      type: this.type,\n      at: this.at,\n      description: this.description,\n      message: this.message,\n      messages: this.messages || [],\n      stack: this.stack || \"\",\n      intent: this.intent,\n      content: this.content,\n      goto: this.goto,\n      state: this.state,\n      recurrence: this.recurrence\n    };\n  }\n};\nvar SYSTEM_DWN_ERRORS = [\n  \"RUNTIME_ERROR\",\n  \"MISCONFIGURATION_ERROR\"\n];\n\n\nasync function process(stateId, errorStr, setupStr) {\n  stateId = stateId || \"\";\n  errorStr = errorStr || \"\";\n  setupStr = setupStr || \"\";\n  let error = DwnError.fromDwnError(errorStr);\n  let config = {};\n  try {\n    const setup = JSON.parse(setupStr);\n    config = createDefaultConfig(setup);\n  } catch (err) {\n    if (!(err instanceof DwnError)) {\n      const description = `[create-config] Unexpected error ${String(err)}`;\n      const stack = err.stack || \"\";\n      err = new DwnError(\n        \"MISCONFIGURATION_ERROR\",\n        description,\n        {\n          stack,\n          goto: null\n        }\n      );\n    }\n    error = err;\n  }\n  if (error && error.toString() !== errorStr) {\n    await context.setVariableAsync(\"dwnError\", error.toString());\n  }\n  if (stateId && stateId.startsWith(\"desk:\")) {\n    await context.setVariableAsync(\"dwnBypass\", \"true\");\n  } else {\n    await context.deleteVariableAsync(\"dwnBypass\");\n  }\n  return config;\n}\nfunction createDefaultConfig(setup) {\n  const current = setup.services ? setup.services.current : undefined;\n  const main = setup.services ? setup.services.main : undefined;\n  const contract = setup.connection ? setup.connection.contract : undefined;\n  const key = setup.connection ? setup.connection.key : undefined;\n  const gmt = setup.gmt;\n  if ([current, main, contract, key, gmt].some((v) => v === undefined)) {\n    throw new Error(\"Invalid Setup Configuration\");\n  }\n  if (!DEFAULT_ERROR_MESSAGES || !DEFAULT_ERROR_MESSAGES[\"UNEXPECTED_INPUT\"]) {\n    throw new Error(\n      \"Default error messages for UNEXPECTED_INPUT are not defined.\"\n    );\n  }\n  const service = {\n    current,\n    main\n  };\n  const connection = {\n    contract,\n    key\n  };\n  let config = {\n    gmt,\n    service,\n    connection,\n    list: DEFAULT_LIST,\n    threshold: DEFAULT_THRESHOLD,\n    stackSize: DEFAULT_STACK_SIZES,\n    intents: DEFAULT_GLOBAL_INTENTS,\n    disabled: DEFAULT_DISABLE,\n    messages: {\n      error: DEFAULT_ERROR_MESSAGES,\n      type: DEFAULT_TYPE_MESSAGES,\n      greeting: DEFAULT_GREETING,\n      intent: DEFAULT_INTENT_MESSAGES\n    },\n    daypart: DEFAULT_DAYPARTS,\n    error: DEFAULT_ERROR,\n    label: DEFAULT_LABEL,\n    password: DEFAULT_PASSWORD,\n    propagate: DEFAULT_PROPAGATE,\n    groups: DEFAULT_CONTACT_GROUPS,\n    debug: DEFAULT_DEBUG\n  };\n  return config;\n}\n",
                    "inputVariables": [
                        "state.id",
                        "dwnError",
                        "config.dwnSetup"
                    ],
                    "outputVariable": "dwnLocalConfig"
                },
                "conditions": [],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_UPD_CORE#f9c180d0-80bb-498b-bf97-d790499ed9dd",
                "$typeOfContent": "",
                "type": "ExecuteScriptV2",
                "$title": "DWN Update Core",
                "settings": {
                    "function": "dwnRun",
                    "source": "/**\n * @author     [Beuren Bechlin] <beuren.bechlin@dawntech.dev>\n * @version    2.0.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n *\n * ---\n *\n * This software is the proprietary property of Dawntech.\n * Possession, use, duplication, or dissemination of this software is strictly\n * prohibited unless you have received prior written permission from\n * Dawntech.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nvar dwnGlobalConfig = \"resource.dwnGlobalConfig\".replace(\"resource.\", \"\");\nasync function dwnRun(coreStr, setupStr, localStr, globalStr, statesStr, prepareStr, errorStr, inputContent, inputType, inputMessage, stateId) {\n  coreStr = coreStr || \"\";\n  localStr = localStr || \"\";\n  globalStr = globalStr || \"\";\n  statesStr = statesStr || \"\";\n  prepareStr = prepareStr || \"\";\n  errorStr = errorStr || \"\";\n  let core;\n  let config = undefined;\n  let local;\n  let global;\n  let states = {};\n  let prepare = undefined;\n  let error = DwnError.fromDwnError(errorStr);\n  let warnings = [];\n  let _states = {\n\t\t\"onboarding\": \"Onboarding - AI\",\n\t\t\"fallback\": \"Fallback - AI\",\n\t\t\"error\": \"DWN Error\",\n\t\t\"bba20407-9fd4-4171-ab18-4778fffe897f\": \"Integra√ß√£o GPT\",\n\t\t\"e88becf1-e28d-4f32-9b0e-a637f76dff62\": \"Anexa hist√≥rico payload\",\n\t\t\"e485f739-cbb1-4867-9d45-cdcae4abbb09\": \"Resposta GPT\",\n\t\t\"DWN/TAGS_BLK#44496c10-7d83-4e06-93b8-22c7b26789fb\": \"DWN Tags\",\n\t\t\"b98e06c1-9584-4544-a7c6-edc8ba90bbed\": \"[Valida] Input pular AI\",\n\t\t\"5db7f064-a288-4a9e-9c63-435e639e0060\": \"[Redirect] Main - Menu\",\n\t\t\"d52c8170-9a73-4b25-b0e3-a2700f87673c\": \"Prepara payload inicial\",\n\t\t\"6363a02e-58b6-42a8-87ae-b68fad85c65c\": \"Aguarda novo input\",\n\t\t\"159fffe3-685b-4678-9874-db9ebee2f5e2\": \"[Redirect] Valida Regex intent\",\n\t\t\"6afc5081-bf43-4b57-84da-031af7a8d2ad\": \"Repetir pergunta\",\n\t\t\"9520a975-50a2-4e9f-8993-9ebe98fbc9e1\": \"Reset context\"\n\t};\n  try {\n    core = JSON.parse(coreStr || \"{}\");\n  } catch (err) {\n    warnings.push(`[update-core] Unexpected core JSON ${String(err)}`);\n    core = {};\n  }\n  let setup;\n  try {\n    setup = JSON.parse(setupStr || \"{}\");\n  } catch (err) {\n    warnings.push(`[update-core] Unexpected setup JSON ${String(err)}`);\n    setup = {};\n  }\n  try {\n    local = JSON.parse(localStr);\n  } catch (err) {\n    warnings.push(`[update-core] Unexpected localConfig JSON ${String(err)}`);\n    local = {};\n  }\n  try {\n    global = JSON.parse(globalStr || \"{}\");\n  } catch (err) {\n    warnings.push(`[update-core] Unexpected globalConfig JSON ${String(err)}`);\n    global = {};\n  }\n  try {\n    prepare = JSON.parse(prepareStr || \"null\");\n  } catch (err) {\n    warnings.push(`[update-core] Unexpected prepare JSON ${String(err)}`);\n    prepare = undefined;\n  }\n  try {\n    states = JSON.parse(statesStr || \"{}\");\n  } catch (err) {\n    warnings.push(`[update-core] Unexpected states JSON ${String(err)}`);\n    states = {};\n  }\n  try {\n    if (error && error.type === \"MISCONFIGURATION_ERROR\") {\n      throw error;\n    }\n    const service = setup.services ? setup.services.current : null;\n    if (!service) {\n      throw new DwnError(\n        \"MISCONFIGURATION_ERROR\",\n        `Setup must have 'services.current' property.`,\n        { goto: null }\n      );\n    }\n    _states = Object.keys(_states).reduce((acc, key) => {\n      acc[`${key}@${service}`] = _states[key];\n      return acc;\n    }, {});\n    states = {\n      ...states,\n      ..._states\n    };\n    await context.setVariableAsync(\"dwnStates\", JSON.stringify(states));\n    local = sanitizeLocalConfig(local, service, states);\n    global = sanitizeGlobalConfig(global, service, states);\n    prepare = sanitizePrepare(prepare, service, states);\n    config = createConfig(global, local, prepare, setup);\n    await context.setVariableAsync(dwnGlobalConfig, JSON.stringify(global));\n    const state = enforceState(\n      stateId || \"onboarding\",\n      service,\n      states\n    );\n    if (prepare.stack > config.threshold.maxStack) {\n      throw new DwnError(\n        \"MISCONFIGURATION_ERROR\",\n        `Stack size (prepare.stack) is greater than the maximum stack size (config.threshold.maxStack).`,\n        { goto: null }\n      );\n    }\n    let replyContent = inputContent || \"\";\n    let replyType = inputType || \"text/plain\";\n    let replyMessage = inputMessage || \"\";\n    let replyPayload = undefined;\n    let replyIntent = null;\n    let replyError = null;\n    let replyState = null;\n    try {\n      const EXPECTED_ERRORS = [\"RUNTIME_ERROR\"];\n      if (error && EXPECTED_ERRORS.includes(error.type)) {\n        throw error;\n      }\n      const content = JSON.parse(inputContent || \"\");\n      if (content.state && content.service) {\n        replyState = {\n          id: content.state,\n          service: content.service\n        };\n        const payload = content;\n        if (payload.payload) {\n          replyPayload = payload.payload;\n        }\n        if (payload.intent) {\n          replyIntent = payload.intent;\n        }\n        if (payload.error) {\n          replyError = payload.error;\n        }\n      }\n    } catch (err) {\n    }\n    try {\n      const metadata = JSON.parse(inputMessage || \"\").metadata;\n      if (metadata && metadata[\"#replyContent\"]) {\n        const replyMenu = JSON.parse(metadata[\"#replyContent\"]);\n        replyContent = replyMenu[\"replied\"][\"value\"];\n        replyType = replyMenu[\"replied\"][\"type\"];\n      }\n    } catch (err) {\n    }\n    const reply = {\n      content: replyContent,\n      type: replyType,\n      message: replyMessage,\n      payload: replyPayload\n    };\n    let intent = null;\n    if (replyIntent) {\n      intent = {\n        id: replyIntent,\n        type: \"static\",\n        scope: \"redirect\",\n        label: `Intent redirect ${replyIntent}`,\n        event: \"dwn-redirect-intents\",\n        pattern: \"\",\n        score: 0\n      };\n    }\n    if (replyError && replyError !== \"PROPAGATE\" && replyState) {\n      if (replyError === \"GOTO\") {\n        error = new DwnError(\"GOTO\", \"Goto error\", {\n          goto: replyState\n        });\n      } else {\n        error = new DwnError(replyError, \"Redirect error\", {\n          state: replyState\n        });\n      }\n    }\n    if (error && error.type === \"PROPAGATE\" && core.error) {\n      error = DwnError.fromJson(core.error);\n    }\n    const stack = core.intents ? core.intents.stack || [] : [];\n    const intents = prepare.intents.length ? [\n      {\n        id: `prepare-${state.service}-${state.id}`,\n        intents: prepare.intents,\n        scope: \"prepare\",\n        event: prepare.id\n      }\n    ] : [];\n    let groups = [\n      ...intents,\n      ...stack,\n      {\n        id: \"config\",\n        intents: config.intents,\n        scope: \"config\",\n        event: \"config\"\n      }\n    ];\n    const checkpoints = core.checkpoints || [];\n    if (checkpoints.length === 0) {\n      config.disabled.intents.push(\"CHECKPOINT_BACK\");\n    }\n    if (config.disabled.intents.length > 0) {\n      groups = groups.map((group) => {\n        group.intents = group.intents.filter((intent2) => {\n          return !config.disabled.intents.includes(intent2.id);\n        });\n        return group;\n      });\n    }\n    let services = core.services || [];\n    const serviceIndex = services.findIndex((_service) => _service === service);\n    if (serviceIndex >= 0) {\n      services.splice(0, serviceIndex + 1);\n    }\n    services.unshift(service);\n    let propagate = config.propagate ? config.propagate : services[1];\n    if (config.service.current === propagate) {\n      propagate = undefined;\n    }\n    core.version = \"2.0.0\";\n    core.errors = core.errors || [];\n    core.checkpoint = prepare.checkpoint || false;\n    core.checkpoints = core.checkpoints || [];\n    core.services = services;\n    core.intent = intent;\n    core.intents = { stack, groups };\n    core.prepare = prepare;\n    core.state = state;\n    core.reply = reply;\n    core.group = core.group || \"A\";\n    core.journey = core.journey || \"{{random.guid}}\";\n    core.sessions = core.sessions || 1;\n    core.service = config.service.current;\n    core.visits = core.visits || [];\n    core.main = config.service.current === config.service.main || undefined;\n    core.propagate = propagate;\n    core.redirect = undefined;\n    await context.setVariableAsync(\"dwnConfig\", JSON.stringify(config));\n  } catch (err) {\n    if (!(err instanceof DwnError)) {\n      const description = `[update-core] Unexpected error ${String(err)}`;\n      const stack = err.stack || \"\";\n      err = new DwnError(\"RUNTIME_ERROR\", description, {\n        stack,\n        goto: null\n      });\n    }\n    error = err;\n  } finally {\n    if (!core || typeof core !== \"object\") {\n      core = {};\n    }\n    core.warnings = warnings;\n    core.error = error ? error.toJson() : null;\n    core.fallback = \"fallback\";\n    coreStr = JSON.stringify(core);\n  }\n  if (prepare) {\n    await context.deleteVariableAsync(\"dwnPrepare\");\n  }\n  if (config && typeof config === \"object\") {\n    await context.setVariableAsync(\"dwnConfig\", JSON.stringify(config));\n  }\n  if (error && error.toString() !== errorStr) {\n    await context.setVariableAsync(\"dwnError\", error.toString());\n  }\n  return coreStr;\n}\nfunction sanitizeLocalConfig(config, service, states) {\n  const intents = config.intents || [];\n  config.intents = intents.map(\n    (intent) => sanitizeIntentSpec(intent, service, states)\n  );\n  return config;\n}\nfunction sanitizeGlobalConfig(config, service, states) {\n  const intents = config.intents || [];\n  config.intents = intents.map(\n    (intent) => sanitizeIntentSpec(intent, service, states, true)\n  );\n  return config;\n}\nfunction createConfig(global, local, prepare, setup) {\n  const config = merge(global, local);\n  const minScore = config.threshold.minScore || prepare.score;\n  if (!minScore) {\n    throw new DwnError(\n      \"MISCONFIGURATION_ERROR\",\n      \"Threshold score (config.threshold.score) is required in the configuration.\",\n      { goto: null }\n    );\n  }\n  if (setup.services) {\n    config.service = setup.services;\n  }\n  if (setup.connection) {\n    config.connection = setup.connection;\n  }\n  if (setup.gmt) {\n    config.gmt = setup.gmt;\n  }\n  if (global.service && global.service.main) {\n    config.service.main = global.service.main;\n  }\n  if (global.connection && global.connection.contract && global.connection.key) {\n    config.connection.contract = global.connection.contract;\n    config.connection.key = global.connection.key;\n  }\n  config.threshold.minScore = minScore;\n  config.error = merge(\n    config.error,\n    prepare.error\n  );\n  config.inactivity = prepare.inactivity || config.inactivity;\n  config.disabled = merge(config.disabled, prepare.disabled);\n  config.disabled.intents = Array.from(new Set(config.disabled.intents));\n  if (!config.inactivity) {\n    config.inactivity = \"INACTIVITY\";\n  }\n  if (!config.service || !config.service.current || !config.service.main || !config.gmt) {\n    throw new DwnError(\n      \"MISCONFIGURATION_ERROR\",\n      `Config must have 'service.current', 'service.main', and 'gmt' properties.`,\n      { goto: null }\n    );\n  }\n  if (!config.label[\"UNEXPECTED\"]) {\n    throw new DwnError(\n      \"MISCONFIGURATION_ERROR\",\n      `Label for 'unexpected' (config.label['${\"UNEXPECTED\"}']) input is required in the configuration.`,\n      { goto: null }\n    );\n  }\n  return config;\n}\nfunction sanitizePrepare(prepare, service, states) {\n  if (!prepare) {\n    prepare = { id: \"prepare-not-set\" };\n  } else {\n    if (!prepare.id) {\n      throw new DwnError(\n        \"MISCONFIGURATION_ERROR\",\n        `Prepare must have 'id' property.`,\n        { goto: null }\n      );\n    }\n  }\n  const v0 = prepare;\n  const latest = prepare;\n  prepare = prepare;\n  prepare.id = kebabCase(prepare.id);\n  prepare.checkpoint = prepare.checkpoint || false;\n  prepare.stack = prepare.stack || 0;\n  prepare.score = prepare.score;\n  prepare.disabled = prepare.disabled || {};\n  prepare.disabled.inactivity = prepare.disabled.inactivity || false;\n  prepare.disabled.intents = prepare.disabled.intents || [];\n  prepare.label = prepare.label;\n  prepare.intents = prepare.intents || [];\n  prepare.models = prepare.models || [];\n  prepare.types = prepare.types || [];\n  let inactivity = latest.inactivity || \"INACTIVITY\";\n  if (v0.error && v0.error.inactivity) {\n    inactivity = v0.error.inactivity;\n  }\n  prepare.inactivity = inactivity;\n  const error = {\n    type: \"UNEXPECTED_INPUT\",\n    messages: [],\n    goto: undefined\n  };\n  if (latest.error && latest.error.type) {\n    error.type = latest.error.type;\n  } else if (v0.error && v0.error.default) {\n    error.type = v0.error.default;\n  }\n  if (latest.error && latest.error.goto) {\n    error.goto = enforceState(latest.error.goto, service, states);\n  }\n  if (latest.error && latest.error.messages) {\n    error.messages = latest.error.messages;\n  } else if (v0.messages) {\n    error.messages = v0.messages;\n  }\n  prepare.error = error;\n  prepare.intents = prepare.intents.map(\n    (intent) => sanitizeIntentSpec(intent, service, states)\n  );\n  return prepare;\n}\nfunction sanitizeIntentSpec(intent, service, states, global = false) {\n  if (!intent.id || !intent.label) {\n    throw new DwnError(\n      \"MISCONFIGURATION_ERROR\",\n      `Intent ${JSON.stringify(intent)} must have 'id' and 'label' properties.`,\n      { goto: null }\n    );\n  }\n  intent.type = intent.type || \"static\";\n  intent.patterns = intent.patterns || [];\n  intent.payload = intent.payload || null;\n  if (global) {\n    const incompleteGoto = intent.goto && !intent.goto.service;\n    if (incompleteGoto) {\n      throw new DwnError(\n        \"MISCONFIGURATION_ERROR\",\n        `Intent ${JSON.stringify(\n          intent\n        )} has an incomplete goto. Service is required in the global config.`,\n        { goto: null }\n      );\n    }\n  }\n  intent.goto = enforceState(intent.goto, service, states);\n  return intent;\n}\n/**\n * @imports\n * @version    2.0.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n */\nvar DwnError = class _DwnError extends Error {\n  /**\n   * Creates a new DwnError instance.\n   *\n   * @param {string} type The error type identifier (e.g., \"VALIDATION_ERROR\", \"SCRIPT_ERROR\")\n   * @param {string} description Human-readable description of what went wrong\n   * @param {{message?: string, messages?: string[], stack?: string, goto?: State | null, state?: State, at?: string, intent?: string | null, content?: string, recurrence?: ErrorRecurrence, code?: string | null, status?: FINALIZATION_STATUS}} [extras] Optional additional error context and metadata:\n   * - `message`: Primary error message for user display\n   * - `messages`: Array of error messages for different contexts\n   * - `stack`: Stack trace or execution context information\n   * - `goto`: Target state to redirect to on error (null means terminate)\n   * - `state`: Flow state where the error occurred\n   * - `at`: Location or context where the error occurred\n   * - `intent`: Associated intent that caused the error\n   * - `content`: Additional error content or context\n   * - `recurrence`: Information about error recurrence patterns\n   * - `code`: Error code for programmatic error handling\n   * - `status`: Finalization status indicating how the error was resolved\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid input provided\");\n   *\n   * const contextError = new DwnError(\"SCRIPT_ERROR\", \"Script execution failed\", {\n   *   state: { id: \"state-123\", service: \"main\" },\n   *   intent: \"user-input\",\n   *   content: \"invalid data\",\n   *   messages: [\"First attempt failed\", \"Retry failed\"],\n   *   goto: { id: \"error-handler\", service: \"main\" }\n   * });\n   * ```\n   */\n  constructor(type, description, extras) {\n    super();\n    this.name = \"DwnError\";\n    const _extras = _DwnError.enforceExtras(extras);\n    this.type = type;\n    this.description = description;\n    this.at = _extras.at;\n    this.content = _extras.content;\n    this.state = _extras.state;\n    this.recurrence = _extras.recurrence;\n    this.goto = _extras.goto;\n    this.message = _extras.message || undefined;\n    this.messages = _extras.messages || [];\n    this.intent = _extras.intent || undefined;\n    this.code = _extras.code || undefined;\n    this.status = _extras.status || undefined;\n    this.stack = _extras.stack || undefined;\n    if (!this.stack) {\n      if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, _DwnError);\n      }\n    }\n  }\n  /**\n   * Creates a DwnError instance from a serialized error string.\n   *\n   * Parses a DWN error string in the format \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\"\n   * and reconstructs the original DwnError instance.\n   *\n   * @param {string} dwnErrorString Serialized error string from toString() method\n   * @returns {DwnError | undefined} DwnError instance or undefined if parsing fails\n   *\n   * @example\n   * ```typescript\n   * const errorString = \"SCRIPT_ERROR -|- Execution failed -|- {...}\";\n   * const error = DwnError.fromDwnError(errorString);\n   * ```\n   */\n  static fromDwnError(dwnErrorString) {\n    if (!dwnErrorString) return undefined;\n    const parts = dwnErrorString.split(\"-|-\");\n    let type = parts.shift();\n    if (!type) {\n      return undefined;\n    }\n    type = type.trim();\n    let description = parts.shift() || \"\";\n    if (description) {\n      description = description.trim();\n    }\n    let extras = undefined;\n    try {\n      extras = JSON.parse(parts.shift() || \"{}\");\n    } catch (e) {\n    }\n    if (extras) {\n      return new _DwnError(type, description, extras);\n    }\n    return new _DwnError(type, description);\n  }\n  /**\n   * Creates a DwnError instance from a JSON object.\n   *\n   * Converts a generic Error object or JSON representation into a properly\n   * structured DwnError instance with all required properties.\n   *\n   * @param {Error} data Error object or JSON data to convert\n   * @returns {DwnError} New DwnError instance\n   *\n   * @example\n   * ```typescript\n   * const jsonData = { type: \"API_ERROR\", description: \"Request failed\" };\n   * const error = DwnError.fromJson(jsonData);\n   * ```\n   */\n  static fromJson(data) {\n    const extras = _DwnError.enforceExtras(data);\n    return new _DwnError(data.type, data.description, extras);\n  }\n  /**\n   * Normalizes and validates error extras properties.\n   *\n   * Ensures all optional properties have default values and validates the structure\n   * of the extras object. Used internally to maintain consistency across error instances.\n   *\n   * @param {DwnError | DwnErrorExtras} [entity] Error entity or extras object to normalize\n   * @returns {Required<DwnErrorExtras>} Normalized extras object with all required properties\n   *\n   * @internal\n   */\n  static enforceExtras(entity) {\n    if (!entity) entity = {};\n    const extras = {};\n    extras.message = entity.message || \"\";\n    extras.messages = entity.messages || [];\n    extras.stack = entity.stack || \"\";\n    extras.goto = entity.goto;\n    extras.state = entity.state || { id: \"\", service: \"\" };\n    extras.at = entity.at || (new Date()).toISOString();\n    extras.intent = entity.intent || \"\";\n    extras.content = entity.content || \"\";\n    extras.recurrence = entity.recurrence || { type: 1, state: 1, combined: 1 };\n    extras.code = entity.code || undefined;\n    extras.status = entity.status || undefined;\n    return extras;\n  }\n  /**\n   * Serializes the error to a string format.\n   *\n   * Converts the DwnError instance into a parseable string format using the pattern\n   * \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\" for storage or transmission.\n   *\n   * @returns {string} Serialized error string\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"API_ERROR\", \"Request failed\");\n   * const serialized = error.toString();\n   * // \"API_ERROR -|- Request failed -|- {...}\"\n   * ```\n   */\n  toString() {\n    const extras = JSON.stringify(_DwnError.enforceExtras(this));\n    return `${this.type} -|- ${this.description} -|- ${extras}`;\n  }\n  /**\n   * Converts the error to a JSON object.\n   *\n   * Serializes all error properties into a plain JavaScript object suitable\n   * for JSON serialization, API responses, or logging.\n   *\n   * @returns {Error} Plain object representation of the error\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid data\");\n   * const json = error.toJson();\n   * console.log(JSON.stringify(json, null, 2));\n   * ```\n   */\n  toJson() {\n    return {\n      type: this.type,\n      at: this.at,\n      description: this.description,\n      message: this.message,\n      messages: this.messages || [],\n      stack: this.stack || \"\",\n      intent: this.intent,\n      content: this.content,\n      goto: this.goto,\n      state: this.state,\n      recurrence: this.recurrence\n    };\n  }\n};\nvar SYSTEM_DWN_ERRORS = [\n  \"RUNTIME_ERROR\",\n  \"MISCONFIGURATION_ERROR\"\n];\n\n\nfunction enforceState(state, currentService, states) {\n  if (!state && typeof state !== \"string\") {\n    return state;\n  }\n  const id = typeof state === \"string\" ? state : state.id;\n  if (!id) {\n    throw new DwnError(\n      \"MISCONFIGURATION_ERROR\",\n      `State ${JSON.stringify(state)} must have 'id' property.`\n    );\n  }\n  const key = `${id}@${currentService}`;\n  let service = typeof state === \"string\" ? currentService : state.service;\n  if (!service) {\n    service = currentService;\n  }\n  let name = typeof state === \"string\" ? \"\" : state.name;\n  if (!name) {\n    name = states[key] || undefined;\n  }\n  return { id, service, name };\n}\n\n\nfunction kebabCase(str) {\n  if (!str) return \"\";\n  const matches = str.match(\n    /[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g\n  );\n  if (!matches) return \"\";\n  return matches.map((x) => x.toLowerCase()).join(\"-\");\n}\n\n\nfunction deepClone(source) {\n  if (source === null || typeof source !== \"object\") {\n    return source;\n  }\n  if (source instanceof Date) {\n    return new Date(source.getTime());\n  }\n  if (Array.isArray(source)) {\n    const newArray = [];\n    for (let i = 0; i < source.length; i++) {\n      newArray[i] = deepClone(source[i]);\n    }\n    return newArray;\n  }\n  const newObject = {};\n  for (const key in source) {\n    if (Object.prototype.hasOwnProperty.call(source, key)) {\n      newObject[key] = deepClone(source[key]);\n    }\n  }\n  return newObject;\n}\nfunction internalMerge(...objects) {\n  const validObjects = objects.filter((obj) => obj && typeof obj === \"object\");\n  if (validObjects.length === 0) return {};\n  const result = deepClone(validObjects[0] || {});\n  for (let i = 1; i < validObjects.length; i++) {\n    const source = validObjects[i];\n    for (const key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        const sourceValue = source[key];\n        const resultValue = result[key];\n        const isPlainObject = (v) => v && typeof v === \"object\" && !Array.isArray(v);\n        if (isPlainObject(resultValue) && isPlainObject(sourceValue)) {\n          result[key] = internalMerge(resultValue, sourceValue);\n        } else if (Array.isArray(resultValue) && Array.isArray(sourceValue)) {\n          result[key] = [...sourceValue, ...resultValue];\n        } else {\n          result[key] = deepClone(sourceValue);\n        }\n      }\n    }\n  }\n  return result;\n}\nfunction merge(...objects) {\n  return internalMerge(...objects);\n}\n",
                    "inputVariables": [
                        "dwnCore",
                        "config.dwnSetup",
                        "dwnLocalConfig",
                        "resource.dwnGlobalConfig",
                        "dwnStates",
                        "dwnPrepare",
                        "dwnError",
                        "input.content",
                        "input.type",
                        "input.message",
                        "state.id"
                    ],
                    "outputVariable": "dwnCore"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "notExists",
                        "variable": "dwnBypass",
                        "$$hashKey": "object:9679"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_UPD_DWN#e785fe01-42e3-405a-b9b0-189f052e9d9a",
                "$typeOfContent": "",
                "type": "ExecuteScriptV2",
                "$title": "DWN Update DWN",
                "settings": {
                    "function": "dwnRun",
                    "source": "/**\n * @author     [Beuren Bechlin] <beuren.bechlin@dawntech.dev>\n * @version    2.0.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n *\n * ---\n *\n * This software is the proprietary property of Dawntech.\n * Possession, use, duplication, or dissemination of this software is strictly\n * prohibited unless you have received prior written permission from\n * Dawntech.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nasync function dwnRun(dwnStr, coreStr, configStr, statesStr, errorStr, listsConfigStr, tunnelOriginator, contactSerialized) {\n  dwnStr = dwnStr || \"\";\n  coreStr = coreStr || \"\";\n  configStr = configStr || \"\";\n  statesStr = statesStr || \"\";\n  errorStr = errorStr || \"\";\n  listsConfigStr = listsConfigStr || \"\";\n  let warnings = [];\n  let error = DwnError.fromDwnError(errorStr);\n  let dwn = null;\n  let core = null;\n  let config = null;\n  let contact;\n  let states = {};\n  let intent = null;\n  let goto = undefined;\n  let lists = { allow: [], block: [] };\n  try {\n    try {\n      core = JSON.parse(coreStr);\n    } catch (err) {\n      warnings.push(`[update-dwn] Unexpected core JSON ${String(err)}`);\n      throw new Error(`core parsing ${String(err)}`);\n    }\n    warnings = core.warnings;\n    const EXPECTED_ERRORS = [\n      \"RUNTIME_ERROR\",\n      \"MISCONFIGURATION_ERROR\",\n      \"PROPAGATE\"\n    ];\n    if (error && EXPECTED_ERRORS.includes(error.type)) {\n      throw error;\n    }\n    try {\n      dwn = JSON.parse(dwnStr || \"{}\");\n    } catch (err) {\n      warnings.push(`[update-dwn] Unexpected dwn JSON ${String(err)}`);\n      dwn = {};\n    }\n    try {\n      states = JSON.parse(statesStr);\n    } catch (err) {\n      warnings.push(`[update-dwn] Unexpected states JSON ${String(err)}`);\n      states = {};\n    }\n    try {\n      config = JSON.parse(configStr);\n    } catch (err) {\n      warnings.push(`[update-dwn] Unexpected config JSON ${String(err)}`);\n      throw new Error(`config parsing ${String(err)}`);\n    }\n    try {\n      contact = JSON.parse(contactSerialized);\n    } catch (err) {\n      warnings.push(`[update-dwn] Unexpected contact JSON ${String(err)}`);\n      throw new Error(`contact parsing ${String(err)}`);\n    }\n    try {\n      lists = JSON.parse(listsConfigStr || \"{}\");\n    } catch (err) {\n      warnings.push(`[update-dwn] Unexpected listsConfig JSON ${String(err)}`);\n      throw new Error(`listsConfig parsing ${String(err)}`);\n    }\n    dwn.error = undefined;\n    dwn.intent = undefined;\n    const prepare = core.prepare;\n    let allowList = [];\n    try {\n      if (!config.list.allow) {\n        throw new Error(\"DISABLED_LIST\");\n      }\n      if (!Array.isArray(lists.allow) || lists.allow.length === 0) {\n        throw new Error(\"allow list is not filled or invalid\");\n      }\n      allowList = lists.allow.map(\n        (id) => user__id(id, contact.identity)\n      );\n    } catch (err) {\n      allowList = [];\n      const _err = err instanceof Error ? err.message : String(err);\n      if (_err !== \"DISABLED_LIST\") {\n        warnings.push(`[update-dwn] Unexpected allowList JSON ${String(err)}`);\n      }\n    }\n    let blockList = [];\n    try {\n      if (!config.list.block) {\n        throw new Error(\"DISABLED_LIST\");\n      }\n      if (!Array.isArray(lists.block) || lists.block.length === 0) {\n        throw new Error(\"blockList is not filled or invalid\");\n      }\n      blockList = lists.block.map(\n        (id) => user__id(id, contact.identity)\n      );\n    } catch (err) {\n      blockList = [];\n      const _err = err instanceof Error ? err.message : String(err);\n      if (_err !== \"DISABLED_LIST\") {\n        warnings.push(`[update-dwn] Unexpected blockList JSON ${err}`);\n      }\n    }\n    let calendar = datetime__process(new Date(), config.gmt);\n    let daypart = daypart__find(calendar.hour, config.daypart);\n    let user = user__process(\n      contact,\n      tunnelOriginator,\n      !Boolean(dwn.user),\n      config.debug,\n      core.group,\n      core.sessions,\n      allowList,\n      blockList\n    );\n    if (user.blocked) {\n      let _error = new DwnError(\n        \"BLOCKED_CONTACT\",\n        \"Blocked contact\",\n        {\n          recurrence: { type: -1, state: -1, combined: -1 },\n          goto: null\n        }\n      );\n      error = error || _error;\n    }\n    let input = input__process(core.reply, prepare.models);\n    if (input.model == \"DEBUG\" && input.payload[\"password\"] === config.password) {\n      user.debug = !user.debug || undefined;\n      const _error = new DwnError(\n        \"DEBUG\",\n        `Debug mode toggled ${user.debug ? \"on\" : \"off\"}`\n      );\n      error = error || _error;\n    }\n    if (input.model == \"GOTO\" && input.payload[\"password\"] === config.password && user.debug) {\n      goto = {\n        id: input.payload.state,\n        service: input.payload.service\n      };\n      const _error = new DwnError(\n        \"GOTO\",\n        `Force state change`,\n        { goto }\n      );\n      error = error || _error;\n    }\n    if (input.type === \"INACTIVITY\" && !config.disabled.inactivity) {\n      const _error = new DwnError(config.inactivity, \"Inactivity detected\", {\n        goto: null\n      });\n      error = error || _error;\n    }\n    if (!intent) {\n      const [_intent, _goto] = redirect__intent(\n        core.intent,\n        core.intents.groups\n      );\n      if (_intent) {\n        intent = _intent;\n        goto = _goto;\n      }\n    }\n    if (!intent) {\n      const [_intent, _goto, _payload] = user__intent(\n        contact,\n        core.intents.groups\n      );\n      if (_intent) {\n        intent = _intent;\n        goto = _goto;\n        input.payload = input.payload || _payload;\n        let _error = new DwnError(\n          \"INTENT\",\n          `Contact intent ${intent.id} matched.`,\n          { goto }\n        );\n        error = error || _error;\n      }\n    }\n    if (!intent) {\n      for (const intentSpec of core.intents.groups) {\n        let [_intent, _goto, _payload] = reply__intent(\n          core.reply,\n          intentSpec,\n          config\n        );\n        if (_intent) {\n          intent = _intent;\n          goto = _goto;\n          input.payload = input.payload || _payload;\n          break;\n        }\n      }\n    }\n    if (intent && intent.id === \"CHECKPOINT_BACK\") {\n      const _goto = core.checkpoints.shift();\n      if (_goto) {\n        goto = goto || _goto;\n      } else {\n        intent = null;\n      }\n    }\n    if (intent && (intent.scope !== \"prepare\" || goto)) {\n      const _error = new DwnError(\n        \"INTENT\",\n        `Intent ${intent.id} in scope ${intent.scope} matched.`,\n        { goto }\n      );\n      error = error || _error;\n    }\n    if (!intent && prepare) {\n      const messages = config.error.messages || [];\n      const goto2 = config.error.goto || undefined;\n      if (prepare.models && prepare.models.length > 0 && !input.model) {\n        const _error = new DwnError(\n          config.error.type,\n          `Unexpected input model. Expected one of: ${prepare.models.join(\n            \", \"\n          )}`,\n          { messages, goto: goto2 }\n        );\n        error = error || _error;\n      } else if (prepare.types && prepare.types.length > 0 && input.type && !prepare.types.includes(input.type)) {\n        const _error = new DwnError(\n          config.error.type,\n          `Unexpected input type: ${input.type}. Expected one of: ${prepare.types.join(\", \")}`,\n          { messages, goto: goto2 }\n        );\n        error = error || _error;\n      } else if (prepare.intents && prepare.intents.length > 0) {\n        intent = {\n          id: undefined,\n          type: \"static\",\n          label: config.label[\"UNEXPECTED\"],\n          scope: \"prepare\",\n          event: prepare.id,\n          pattern: \"\",\n          score: 0\n        };\n      }\n    }\n    if (core.checkpoint) {\n      const checkpointIndex = core.checkpoints.findIndex(\n        (checkpoint) => checkpoint.id === core.state.id && checkpoint.service === core.service\n      );\n      if (checkpointIndex >= 0) {\n        core.checkpoints.splice(0, checkpointIndex + 1);\n      }\n      core.checkpoints.unshift(core.state);\n      core.checkpoints = core.checkpoints.slice(\n        0,\n        config.stackSize.checkpoints\n      );\n    }\n    if (prepare.intents && prepare.stack > 0) {\n      const intentsGroup = {\n        id: prepare.id,\n        intents: prepare.intents,\n        scope: \"stack\",\n        event: prepare.id\n      };\n      const stackLastIndex = core.intents.stack.reduce(\n        (lastIndex, intent2, index) => intent2.id === prepare.id ? index : lastIndex,\n        -1\n      );\n      if (stackLastIndex >= 0) {\n        core.intents.stack.splice(0, stackLastIndex + 1);\n      }\n      const groups = new Array(prepare.stack).fill(intentsGroup);\n      core.intents.stack.unshift(...groups);\n      core.intents.stack = core.intents.stack.slice(\n        0,\n        config.stackSize.intents\n      );\n    }\n    dwn.journey = core.journey;\n    dwn.daypart = daypart;\n    dwn.greeting = config.messages.greeting[daypart];\n    dwn.calendar = calendar;\n    dwn.input = input;\n    dwn.user = user;\n    dwn.service = config.service.current;\n    dwn.main = core.main || false;\n    dwn.error = undefined;\n    if (error) {\n      error.goto = enforceState(error.goto, config.service.current, states);\n      dwn.error = error.toJson();\n    }\n    dwn.intent = intent || undefined;\n    core.intent = intent || null;\n  } catch (err) {\n    if (!(err instanceof DwnError)) {\n      const description = `[update-dwn] Unexpected error ${String(err)}`;\n      const stack = err.stack || \"\";\n      err = new DwnError(\"RUNTIME_ERROR\", description, {\n        stack,\n        goto: null\n      });\n    }\n    error = err;\n  } finally {\n    if (!core || typeof core !== \"object\") {\n      core = {};\n    }\n    if (!dwn || typeof dwn !== \"object\") {\n      dwn = {};\n    }\n    if (error) {\n      dwn.error = error.toJson();\n    }\n    core.warnings = warnings;\n    dwn.warnings = core.warnings.join(\"\\n\");\n    dwnStr = JSON.stringify(dwn);\n  }\n  if (core && typeof core === \"object\") {\n    await context.setVariableAsync(\"dwnCore\", JSON.stringify(core));\n  }\n  if (error && error.toString() !== errorStr) {\n    await context.setVariableAsync(\"dwnError\", error.toString());\n  }\n  return dwnStr;\n}\nfunction user__source(contactIdentity) {\n  contactIdentity = String(contactIdentity);\n  if (contactIdentity.includes(\"@0mn.io\")) return \"BLIP_CHAT\";\n  if (contactIdentity.includes(\"@mailgun.gw.msging.net\"))\n    return \"E_MAIL\";\n  if (contactIdentity.includes(\"@messenger.gw.msging.net\"))\n    return \"MESSENGER\";\n  if (contactIdentity.includes(\"@skype.gw.msging.net\"))\n    return \"SKYPE\";\n  if (contactIdentity.includes(\"@take.io\")) return \"SMS_TAKE\";\n  if (contactIdentity.includes(\"@tangram.com.br\"))\n    return \"SMS_TANGRAM\";\n  if (contactIdentity.includes(\"@telegram.gw.msging.net\"))\n    return \"TELEGRAM\";\n  if (contactIdentity.includes(\"@wa.gw.msging.net\"))\n    return \"WHATSAPP\";\n  if (contactIdentity.includes(\"@instagram.gw.msging.net\"))\n    return \"INSTAGRAM\";\n  if (contactIdentity.includes(\"@googlercs.gw.msging.net\"))\n    return \"GOOGLE_RCS\";\n  if (contactIdentity.includes(\"@abs.gw.msging.net\"))\n    return \"MICROSOFT_TEAMS\";\n  if (contactIdentity.includes(\"@businesschat.gw.msging.net\"))\n    return \"APPLE_BUSINESS_CHAT\";\n  if (contactIdentity.includes(\"@workplace.gw.msging.net\"))\n    return \"WORKPLACE\";\n  return \"OUTRO\";\n}\nfunction user__id(contactPrefix, contactId) {\n  if (contactPrefix.includes(\"@\")) return contactPrefix;\n  const source = user__source(contactId);\n  const domains = {\n    [\"BLIP_CHAT\"]: \"@0mn.io\",\n    [\"E_MAIL\"]: \"@mailgun.gw.msging.net\",\n    [\"MESSENGER\"]: \"@messenger.gw.msging.net\",\n    [\"SKYPE\"]: \"@skype.gw.msging.net\",\n    [\"SMS_TAKE\"]: \"@take.io\",\n    [\"SMS_TANGRAM\"]: \"@tangram.com.br\",\n    [\"TELEGRAM\"]: \"@telegram.gw.msging.net\",\n    [\"WHATSAPP\"]: \"@wa.gw.msging.net\",\n    [\"INSTAGRAM\"]: \"@instagram.gw.msging.net\",\n    [\"GOOGLE_RCS\"]: \"@googlercs.gw.msging.net\",\n    [\"MICROSOFT_TEAMS\"]: \"@abs.gw.msging.net\",\n    [\"APPLE_BUSINESS_CHAT\"]: \"@businesschat.gw.msging.net\",\n    [\"WORKPLACE\"]: \"@workplace.gw.msging.net\",\n    [\"OUTRO\"]: \"\"\n  };\n  return `${contactPrefix}${domains[source] || \"\"}`;\n}\nfunction redirect__intent(intent, groups) {\n  const { id, scope } = intent || {};\n  let goto = undefined;\n  const group = groups.find((group2) => group2.id === \"config\");\n  intent = null;\n  if (id && group && scope === \"redirect\") {\n    const _intent = group.intents.find((_intent2) => _intent2.id === id);\n    if (_intent) {\n      intent = {\n        id: _intent.id,\n        type: \"static\",\n        label: `Intent redirect ${_intent.id}`,\n        scope: \"redirect\",\n        event: \"dwn-redirect-intents\",\n        pattern: \"\",\n        score: 0\n      };\n      goto = _intent.goto || undefined;\n    }\n  }\n  return [intent, goto];\n}\nfunction user__intent(contact, groups) {\n  let intent = null;\n  let goto = undefined;\n  let payload = null;\n  let id = undefined;\n  let event = \"dwn-contact-intents\";\n  const group = groups.find((group2) => group2.id === \"config\");\n  try {\n    if (!contact.extras[\"intent\"]) throw new Error(\"Intent not found\");\n    let extras = {};\n    const [intent2, extrasStr] = contact.extras[\"intent\"].split(\"-|-\");\n    id = intent2 || undefined;\n    try {\n      extras = JSON.parse(extrasStr || \"{}\");\n    } catch (e) {\n    }\n    if (extras.event) {\n      event = extras.event;\n    }\n    if (extras.payload) {\n      payload = extras.payload;\n    }\n    if (extras.dueDate && extras.expired && extras.expired.intent) {\n      const date = new Date(extras.dueDate || 0);\n      if ((new Date()).getTime() > date.getTime()) {\n        id = extras.expired.intent;\n      }\n      if (extras.expired.event) {\n        event = extras.expired.event;\n      }\n    }\n  } catch (e) {\n  }\n  if (id && group) {\n    const intentSpec = group.intents.find((intent2) => intent2.id === id);\n    if (intentSpec) {\n      goto = intentSpec.goto;\n      intent = {\n        id: id ? id.trim() : undefined,\n        type: \"static\",\n        label: `Intent contact extra ${id}`,\n        scope: \"contact\",\n        event,\n        pattern: \"\",\n        score: 0\n      };\n    }\n  }\n  return [intent, goto, payload];\n}\nfunction user__process(contact, tunnelOriginator, newUser, configDebug, group, sessions, allowList, blockList) {\n  const id = tunnelOriginator ? tunnelOriginator : contact.identity;\n  const source = user__source(contact.identity);\n  const debug = Boolean(contact.extras && contact.extras[\"debug\"]) || configDebug || undefined;\n  const blocked = blockList.some(\n    (id2) => contact.identity === user__id(id2, contact.identity)\n  );\n  const allowed = allowList.some(\n    (id2) => contact.identity === user__id(id2, contact.identity)\n  );\n  const phone = source === \"WHATSAPP\" ? contact.identity.split(\"@\")[0] : undefined;\n  const cellphone = source === \"WHATSAPP\" ? contact.identity.split(\"@\")[0].substring(2) : undefined;\n  const DDD = source === \"WHATSAPP\" ? contact.identity.split(\"@\")[0].substring(2, 4) : undefined;\n  return {\n    id,\n    source,\n    new: newUser || undefined,\n    blocked,\n    allowed,\n    group,\n    sessions,\n    cellphone,\n    phone,\n    DDD,\n    debug\n  };\n}\nfunction datetime__to_iso_with_offset(date, tzOffset) {\n  const dateTz = new Date(date.getTime() + tzOffset * 36e5);\n  const dateFormatted = dateTz.toISOString().split(\".\")[0];\n  const offsetSign = tzOffset >= 0 ? \"+\" : \"-\";\n  const offsetHours = Math.abs(Math.floor(tzOffset)).toString().padStart(2, \"0\");\n  const offsetMinutes = Math.abs(tzOffset % 1 * 60).toString().padStart(2, \"0\");\n  return `${dateFormatted}${offsetSign}${offsetHours}:${offsetMinutes}`;\n}\nfunction datetime__process(date, tzOffset) {\n  const datetime = datetime__to_iso_with_offset(date, tzOffset);\n  const calendar = {\n    datetime,\n    date: datetime.split(\"T\")[0],\n    time: datetime.split(\"T\")[1].split(\".\")[0].substring(0, 8),\n    hour: parseInt(datetime.split(\"T\")[1].substring(0, 2)),\n    minute: parseInt(datetime.split(\"T\")[1].substring(3, 5)),\n    GMT: tzOffset\n  };\n  return calendar;\n}\nfunction daypart__find(hour, daypart) {\n  if (isNaN(hour) || hour < 0 || hour > 23) {\n    throw new DwnError(\n      \"RUNTIME_ERROR\",\n      `Invalid hour: ${hour}`,\n      { goto: null }\n    );\n  }\n  if (!daypart || !daypart.MORNING || !daypart.AFTERNOON || !daypart.EVENING || !daypart.NIGHT) {\n    throw new DwnError(\n      \"MISCONFIGURATION_ERROR\",\n      \"Daypart configuration is incomplete\",\n      { goto: null }\n    );\n  }\n  if (daypart.MORNING.includes(hour)) return \"MORNING\";\n  if (daypart.AFTERNOON.includes(hour)) return \"AFTERNOON\";\n  if (daypart.EVENING.includes(hour)) return \"EVENING\";\n  if (daypart.NIGHT.includes(hour)) return \"NIGHT\";\n  throw new DwnError(\n    \"MISCONFIGURATION_ERROR\",\n    `Hour ${hour} not found in any daypart`,\n    { goto: null }\n  );\n}\nfunction type__inactivity(reply) {\n  return reply.content === \"\" ? null : undefined;\n}\nfunction type__flows(reply) {\n  try {\n    return JSON.parse(\n      JSON.parse(reply.message).metadata[\"#wa.interactive.nfm_reply.json_response\"]\n    );\n  } catch (err) {\n  }\n  return undefined;\n}\nfunction type__ctwa(reply) {\n  try {\n    const { metadata } = JSON.parse(reply.message || \"{}\");\n    if (metadata && metadata[\"#wa.referral.source_id\"]) {\n      return {\n        headline: metadata[\"#wa.referral.headline\"],\n        body: metadata[\"#wa.referral.body\"],\n        source_type: metadata[\"#wa.referral.source_type\"],\n        source_id: metadata[\"#wa.referral.source_id\"],\n        source_url: metadata[\"#wa.referral.source_url\"],\n        media_id: metadata[\"#wa.referral.image.id\"]\n      };\n    }\n  } catch (err) {\n  }\n  return undefined;\n}\nfunction type__cart(reply) {\n  if (reply.type.includes(\"x-whatsapp-order+json\")) {\n    return null;\n  }\n  return undefined;\n}\nfunction type__text(reply) {\n  return reply.type === \"text/plain\" ? null : undefined;\n}\nfunction type__image(reply) {\n  try {\n    const _content = JSON.parse(reply.content);\n    let _type = _content && _content.type && _content.type.toLowerCase() || \"\";\n    if (_type.includes(\"image\")) {\n      return null;\n    }\n  } catch (err) {\n  }\n  return undefined;\n}\nfunction type__sticker(reply) {\n  try {\n    const _content = JSON.parse(reply.content);\n    let _type = _content && _content.type && _content.type.toLowerCase() || \"\";\n    if (_type.includes(\"sticker\")) {\n      return null;\n    }\n  } catch (err) {\n  }\n  return undefined;\n}\nfunction type__video(reply) {\n  try {\n    const _content = JSON.parse(reply.content);\n    let _type = _content && _content.type && _content.type.toLowerCase() || \"\";\n    if (_type.includes(\"video\")) {\n      return null;\n    }\n  } catch (err) {\n  }\n  return undefined;\n}\nfunction type__audio(reply) {\n  try {\n    const _content = JSON.parse(reply.content);\n    let _type = _content && _content.type && _content.type.toLowerCase() || \"\";\n    if (_type.includes(\"audio\")) {\n      return null;\n    }\n  } catch (err) {\n  }\n  return undefined;\n}\nfunction type__document(reply) {\n  try {\n    const _content = JSON.parse(reply.content);\n    let _type = _content && _content.type && _content.type.toLowerCase() || \"\";\n    if (_type.includes(\"application\")) {\n      return null;\n    }\n  } catch (err) {\n  }\n  return undefined;\n}\nfunction type__location(reply) {\n  try {\n    const _content = JSON.parse(reply.message).content;\n    if (typeof _content === \"string\") {\n      return undefined;\n    }\n    let _type = reply.type;\n    if (_type.includes(\"location\")) {\n      return {\n        latitude: _content.latitude,\n        longitude: _content.longitude\n      };\n    }\n  } catch (err) {\n  }\n  return undefined;\n}\nfunction model__cep(reply) {\n  const text = reply.content;\n  if (typeof text !== \"string\") {\n    return undefined;\n  }\n  const cleaned = text.replace(/\\D/g, \"\");\n  if (cleaned.length !== 8) {\n    return undefined;\n  }\n  return {\n    value: cleaned,\n    pretty: `${cleaned.slice(0, 5)}-${cleaned.slice(5)}`\n  };\n}\nfunction model__cpf(reply) {\n  const text = reply.content;\n  if (typeof text !== \"string\") {\n    return undefined;\n  }\n  const cpf = text.replace(/\\D/g, \"\");\n  if (cpf.length !== 11 || /^(\\d)\\1{10}$/.test(cpf)) {\n    return undefined;\n  }\n  let sum = 0;\n  let remainder;\n  for (let i = 1; i <= 9; i++) {\n    sum = sum + parseInt(cpf.substring(i - 1, i)) * (11 - i);\n  }\n  remainder = sum * 10 % 11;\n  if (remainder === 10 || remainder === 11) {\n    remainder = 0;\n  }\n  if (remainder !== parseInt(cpf.substring(9, 10))) {\n    return undefined;\n  }\n  sum = 0;\n  for (let i = 1; i <= 10; i++) {\n    sum = sum + parseInt(cpf.substring(i - 1, i)) * (12 - i);\n  }\n  remainder = sum * 10 % 11;\n  if (remainder === 10 || remainder === 11) {\n    remainder = 0;\n  }\n  if (remainder !== parseInt(cpf.substring(10, 11))) {\n    return undefined;\n  }\n  return {\n    value: cpf,\n    pretty: cpf.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, \"$1.$2.$3-$4\")\n  };\n}\nfunction model__cnpj(reply) {\n  const text = reply.content;\n  if (typeof text !== \"string\") {\n    return undefined;\n  }\n  const cnpj = text.replace(/\\D/g, \"\");\n  if (cnpj.length !== 14 || /^(\\d)\\1{13}$/.test(cnpj)) {\n    return undefined;\n  }\n  let size = cnpj.length - 2;\n  let numbers = cnpj.substring(0, size);\n  const digits = cnpj.substring(size);\n  let sum = 0;\n  let pos = size - 7;\n  for (let i = size; i >= 1; i--) {\n    sum += parseInt(numbers.charAt(size - i)) * pos--;\n    if (pos < 2) {\n      pos = 9;\n    }\n  }\n  let result = sum % 11 < 2 ? 0 : 11 - sum % 11;\n  if (result !== parseInt(digits.charAt(0))) {\n    return undefined;\n  }\n  size = size + 1;\n  numbers = cnpj.substring(0, size);\n  sum = 0;\n  pos = size - 7;\n  for (let i = size; i >= 1; i--) {\n    sum += parseInt(numbers.charAt(size - i)) * pos--;\n    if (pos < 2) {\n      pos = 9;\n    }\n  }\n  result = sum % 11 < 2 ? 0 : 11 - sum % 11;\n  if (result !== parseInt(digits.charAt(1))) {\n    return undefined;\n  }\n  return {\n    value: cnpj,\n    pretty: cnpj.replace(\n      /(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})/,\n      \"$1.$2.$3/$4-$5\"\n    )\n  };\n}\nfunction model__birth_day(reply) {\n  const text = reply.content;\n  if (typeof text !== \"string\") {\n    return undefined;\n  }\n  const match = text.trim().match(/^(\\d{1,2})[\\/.-](\\d{1,2})[\\/.-](\\d{4})$/);\n  if (!match) return undefined;\n  const day = parseInt(match[1], 10);\n  const month = parseInt(match[2], 10);\n  const year = parseInt(match[3], 10);\n  const date = new Date(year, month - 1, day);\n  if (date.getFullYear() !== year || date.getMonth() + 1 !== month || date.getDate() !== day) {\n    return undefined;\n  }\n  const dayStr = String(day).padStart(2, \"0\");\n  const monthStr = String(month).padStart(2, \"0\");\n  const yearStr = String(year);\n  return {\n    year: yearStr,\n    month: monthStr,\n    day: dayStr,\n    pretty: `${dayStr}/${monthStr}/${yearStr}`\n  };\n}\nfunction model__name(reply) {\n  const text = reply.content;\n  if (typeof text !== \"string\") {\n    return undefined;\n  }\n  const cleaned = text.trim();\n  const nameRegex = /^[a-zA-Z\\u00C0-\\u017F]+$/;\n  if (nameRegex.test(cleaned) && cleaned.split(/\\s+/).length === 1) {\n    const lowercase = cleaned.toLowerCase();\n    const pretty = lowercase.charAt(0).toUpperCase() + lowercase.slice(1);\n    return {\n      value: lowercase,\n      pretty\n    };\n  }\n  return undefined;\n}\nfunction model__full_name(reply) {\n  const text = reply.content;\n  if (typeof text !== \"string\") {\n    return undefined;\n  }\n  const cleaned = text.trim();\n  const fullNameRegex = /^[a-zA-Z\\u00C0-\\u017F]+(?:\\s[a-zA-Z\\u00C0-\\u017F]+)+$/;\n  if (fullNameRegex.test(cleaned)) {\n    const names = cleaned.split(/\\s+/).map((n) => n.toLowerCase());\n    if (names.length < 2) return undefined;\n    const prettyNames = names.map(\n      (name) => name.charAt(0).toUpperCase() + name.slice(1)\n    );\n    const first = prettyNames[0];\n    const last = prettyNames.slice(1).join(\" \");\n    const pretty = prettyNames.join(\" \");\n    return {\n      first,\n      last,\n      names,\n      lowercase: cleaned.toLowerCase(),\n      pretty\n    };\n  }\n  return undefined;\n}\nfunction model__email(reply) {\n  const text = reply.content;\n  if (typeof text !== \"string\") {\n    return undefined;\n  }\n  const emailRegex = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n  const lowercasedText = text.toLowerCase().trim();\n  if (emailRegex.test(lowercasedText)) {\n    const parts = lowercasedText.split(\"@\");\n    return {\n      host: parts[0],\n      domain: parts[1],\n      pretty: lowercasedText\n    };\n  }\n  return undefined;\n}\nfunction model__phone(reply) {\n  const text = reply.content;\n  if (typeof text !== \"string\") {\n    return undefined;\n  }\n  const cleaned = text.replace(/\\D/g, \"\");\n  if (cleaned.length < 10 || cleaned.length > 15) {\n    return undefined;\n  }\n  let country = \"55\";\n  let remainingDigits = cleaned;\n  if (cleaned.length >= 12) {\n    const possibleCountry = cleaned.substring(0, cleaned.length - 10);\n    if (possibleCountry.length >= 1 && possibleCountry.length <= 3) {\n      country = possibleCountry;\n      remainingDigits = cleaned.substring(possibleCountry.length);\n    }\n  }\n  if (country === \"55\") {\n    if (remainingDigits.length < 10 || remainingDigits.length > 11) {\n      return undefined;\n    }\n    const ddd = remainingDigits.substring(0, 2);\n    const phone = remainingDigits.substring(2);\n    const dddNum = parseInt(ddd, 10);\n    if (dddNum < 11 || dddNum > 99) {\n      return undefined;\n    }\n    if (phone.length !== 8 && phone.length !== 9) {\n      return undefined;\n    }\n    if (phone.length === 9 && phone[0] !== \"9\") {\n      return undefined;\n    }\n    const phonePart1 = phone.length === 9 ? phone.substring(0, 5) : phone.substring(0, 4);\n    const phonePart2 = phone.length === 9 ? phone.substring(5) : phone.substring(4);\n    const local = `(${ddd}) ${phonePart1}-${phonePart2}`;\n    const global = `+${country} ${local}`;\n    return {\n      value: country + ddd + phone,\n      country,\n      ddd,\n      phone,\n      pretty: { global, local }\n    };\n  }\n  if (remainingDigits.length >= 10) {\n    const ddd = remainingDigits.substring(0, 2);\n    const phone = remainingDigits.substring(2);\n    const phonePart1 = phone.substring(0, Math.ceil(phone.length / 2));\n    const phonePart2 = phone.substring(Math.ceil(phone.length / 2));\n    const local = `${ddd} ${phonePart1}-${phonePart2}`;\n    const global = `+${country} ${local}`;\n    return {\n      value: country + ddd + phone,\n      country,\n      ddd,\n      phone,\n      pretty: { global, local }\n    };\n  }\n  return undefined;\n}\nfunction model__debug(reply) {\n  const text = reply.content;\n  if (typeof text !== \"string\") {\n    return undefined;\n  }\n  const match = text.trim().match(/^#debug\\s+(\\S+)$/i);\n  if (match) {\n    const [_, password] = match;\n    return { password };\n  }\n  return undefined;\n}\nfunction model__goto(reply) {\n  const text = reply.content;\n  if (typeof text !== \"string\") {\n    return undefined;\n  }\n  const match = text.trim().match(/^#goto\\s+(\\S+)\\s+(\\S+)(?:\\s+(\\S+))?$/i);\n  if (match) {\n    const [_, password, state, service] = match;\n    return { password, state, service };\n  }\n  return undefined;\n}\nfunction model__ctwa(reply) {\n  const message = reply.message;\n  try {\n    const { metadata } = JSON.parse(message || \"{}\");\n    if (metadata && metadata[\"#wa.referral.source_id\"]) {\n      return {\n        headline: metadata[\"#wa.referral.headline\"],\n        body: metadata[\"#wa.referral.body\"],\n        source_type: metadata[\"#wa.referral.source_type\"],\n        source_id: metadata[\"#wa.referral.source_id\"],\n        source_url: metadata[\"#wa.referral.source_url\"],\n        media_id: metadata[\"#wa.referral.image.id\"]\n      };\n    }\n  } catch (err) {\n  }\n  return undefined;\n}\nfunction model__flows(reply) {\n  const message = reply.message;\n  try {\n    return JSON.parse(\n      JSON.parse(message).metadata[\"#wa.interactive.nfm_reply.json_response\"]\n    );\n  } catch (err) {\n  }\n  return undefined;\n}\nfunction model__cart(reply) {\n  if (reply.type.includes(\"x-whatsapp-order+json\")) {\n    return null;\n  }\n  return undefined;\n}\nfunction model__car_plate(reply) {\n  const text = reply.content;\n  const cleaned = text.replace(/-/g, \"\").trim().toUpperCase();\n  const carPlateRegex = /^[A-Z]{3}[\\d][A-Z\\d][\\d]{2}$/;\n  if (carPlateRegex.test(cleaned)) {\n    const pretty = `${cleaned.substring(0, 3)}-${cleaned.substring(3)}`;\n    return {\n      value: cleaned,\n      pretty\n    };\n  }\n  return undefined;\n}\nfunction input__process(reply, models) {\n  let content = reply.content;\n  let model = undefined;\n  let payload = null;\n  let type = \"TEXT\";\n  const _types = [\n    \"INACTIVITY\",\n    \"FLOWS\",\n    \"CTWA\",\n    \"CART\",\n    \"TEXT\",\n    \"IMAGE\",\n    \"STICKER\",\n    \"VIDEO\",\n    \"AUDIO\",\n    \"DOCUMENT\",\n    \"LOCATION\"\n  ];\n  const typeExec = {\n    [\"INACTIVITY\"]: type__inactivity,\n    [\"FLOWS\"]: type__flows,\n    [\"CTWA\"]: type__ctwa,\n    [\"CART\"]: type__cart,\n    [\"TEXT\"]: type__text,\n    [\"IMAGE\"]: type__image,\n    [\"STICKER\"]: type__sticker,\n    [\"VIDEO\"]: type__video,\n    [\"AUDIO\"]: type__audio,\n    [\"DOCUMENT\"]: type__document,\n    [\"LOCATION\"]: type__location\n  };\n  const modelExec = {\n    [\"GOTO\"]: model__goto,\n    [\"DEBUG\"]: model__debug,\n    [\"CEP\"]: model__cep,\n    [\"CPF\"]: model__cpf,\n    [\"CNPJ\"]: model__cnpj,\n    [\"BIRTH_DAY\"]: model__birth_day,\n    [\"NAME\"]: model__name,\n    [\"FULL_NAME\"]: model__full_name,\n    [\"EMAIL\"]: model__email,\n    [\"PHONE\"]: model__phone,\n    [\"CAR_PLATE\"]: model__car_plate,\n    [\"CTWA\"]: model__ctwa,\n    [\"FLOWS\"]: model__flows,\n    [\"CART\"]: model__cart,\n    [\"LOCATION\"]: type__location\n  };\n  type = _types.find((input_type) => typeExec[input_type](reply) !== undefined) || \"TEXT\";\n  payload = typeExec[type](reply);\n  const _models = [\n    \"GOTO\",\n    \"DEBUG\",\n    ...models || []\n  ];\n  const MODELS = [\n    \"GOTO\",\n    \"DEBUG\",\n    \"CEP\",\n    \"CPF\",\n    \"CNPJ\",\n    \"BIRTH_DAY\",\n    \"NAME\",\n    \"FULL_NAME\",\n    \"EMAIL\",\n    \"PHONE\",\n    \"CAR_PLATE\",\n    \"CTWA\",\n    \"FLOWS\",\n    \"CART\",\n    \"LOCATION\"\n  ];\n  const invalids = _models.filter((model2) => !MODELS.includes(model2));\n  if (invalids.length > 0) {\n    throw new DwnError(\n      \"MISCONFIGURATION_ERROR\",\n      `Invalid model '${invalids.join(\", \")}'. Must be one of: ${MODELS.join(\n        \", \"\n      )}`,\n      { goto: null }\n    );\n  }\n  model = _models.find(\n    (input_model) => modelExec[input_model](reply) !== undefined\n  );\n  if (model) {\n    payload = modelExec[model](reply);\n  }\n  if (reply.payload) {\n    payload = reply.payload;\n  }\n  return {\n    content,\n    type,\n    payload,\n    model\n  };\n}\nfunction input__content(text) {\n  return String(text).trim().toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").replace(/[^a-z0-9\\s]/g, \"\");\n}\nfunction reply__intent(reply, intentGroup, config) {\n  const { threshold } = config;\n  let minScore = threshold && threshold.minScore ? threshold.minScore : 0.75;\n  let intent = null;\n  let goto = undefined;\n  let payload = null;\n  for (const intentSpec of intentGroup.intents) {\n    const { type } = intentSpec;\n    if (type === \"fuzzy\") {\n      const _intent = intent__fuzzy(reply, intentSpec, intentGroup);\n      if (_intent && (!intent || intent.score < _intent.score)) {\n        intent = _intent;\n        goto = intentSpec.goto;\n        payload = intentSpec.payload || null;\n        continue;\n      }\n    }\n    if (type === \"regex\") {\n      const _intent = intent__regex(reply, intentSpec, intentGroup);\n      if (_intent) {\n        intent = _intent;\n        goto = intentSpec.goto;\n        payload = intentSpec.payload || null;\n        break;\n      }\n    }\n    if (type === \"static\") {\n      const _intent = intent__static(reply, intentSpec, intentGroup);\n      if (_intent) {\n        intent = _intent;\n        goto = intentSpec.goto;\n        payload = intentSpec.payload || null;\n        break;\n      }\n    }\n  }\n  if (intent && intent.type === \"fuzzy\" && intent.score < minScore) {\n    intent = null;\n    goto = undefined;\n  }\n  return [intent, goto, payload];\n}\nfunction intent__regex(reply, intentSpec, intentGroup) {\n  const { scope, event } = intentGroup;\n  const { id, patterns, label } = intentSpec;\n  let intent = null;\n  const score = 0;\n  const type = \"regex\";\n  try {\n    for (const pattern of patterns || []) {\n      if (new RegExp(pattern, \"i\").test(reply.content)) {\n        intent = {\n          id,\n          type,\n          scope,\n          label,\n          event,\n          pattern,\n          score\n        };\n      }\n    }\n  } catch (err) {\n    throw new DwnError(\n      \"RUNTIME_ERROR\",\n      `Error processing regex intent ${intentSpec.id}, error: ${err.message}`,\n      { goto: null }\n    );\n  }\n  return intent;\n}\nfunction intent__fuzzy(reply, intentSpec, intentGroup) {\n  const { scope, event } = intentGroup;\n  const { id, patterns, label } = intentSpec;\n  const content = input__content(reply.content);\n  const type = \"fuzzy\";\n  let intent = null;\n  let highest = 0;\n  function similarity_score(a, b) {\n    const maxLen = Math.max(a.length, b.length);\n    if (maxLen === 0) return 1;\n    return 1 - levenshtein_distance(a, b) / maxLen;\n  }\n  function levenshtein_distance(a, b) {\n    const matrix = [];\n    for (let i = 0; i <= b.length; i++) matrix[i] = [i];\n    for (let j = 0; j <= a.length; j++) matrix[0][j] = j;\n    for (let i = 1; i <= b.length; i++) {\n      for (let j = 1; j <= a.length; j++) {\n        if (b[i - 1] === a[j - 1]) {\n          matrix[i][j] = matrix[i - 1][j - 1];\n        } else {\n          matrix[i][j] = Math.min(\n            matrix[i - 1][j - 1] + 1,\n            matrix[i][j - 1] + 1,\n            matrix[i - 1][j] + 1\n          );\n        }\n      }\n    }\n    return matrix[b.length][a.length];\n  }\n  for (const pattern of patterns || []) {\n    const example = input__content(pattern);\n    const score = similarity_score(content, example);\n    if (score > highest) {\n      highest = score;\n      intent = {\n        id,\n        type,\n        scope,\n        label,\n        event,\n        pattern,\n        score\n      };\n    }\n  }\n  return intent;\n}\nfunction intent__static(reply, intentSpec, intentGroup) {\n  const { scope, event } = intentGroup;\n  const { id, patterns, label } = intentSpec;\n  let intent = null;\n  const score = 0;\n  const type = \"static\";\n  try {\n    let words = patterns || [];\n    if (words.includes(reply.content)) {\n      intent = {\n        id,\n        type,\n        scope,\n        label,\n        event,\n        pattern: reply.content,\n        score\n      };\n    }\n  } catch (err) {\n    throw new DwnError(\n      \"RUNTIME_ERROR\",\n      `Error processing regex intent ${intentSpec.id}, error: ${err.message}`,\n      { goto: null }\n    );\n  }\n  return intent;\n}\n/**\n * @imports\n * @version    2.0.0\n * @copyright  2025 Dawntech. All rights reserved.\n * @license    All Rights Reserved\n */\nvar DwnError = class _DwnError extends Error {\n  /**\n   * Creates a new DwnError instance.\n   *\n   * @param {string} type The error type identifier (e.g., \"VALIDATION_ERROR\", \"SCRIPT_ERROR\")\n   * @param {string} description Human-readable description of what went wrong\n   * @param {{message?: string, messages?: string[], stack?: string, goto?: State | null, state?: State, at?: string, intent?: string | null, content?: string, recurrence?: ErrorRecurrence, code?: string | null, status?: FINALIZATION_STATUS}} [extras] Optional additional error context and metadata:\n   * - `message`: Primary error message for user display\n   * - `messages`: Array of error messages for different contexts\n   * - `stack`: Stack trace or execution context information\n   * - `goto`: Target state to redirect to on error (null means terminate)\n   * - `state`: Flow state where the error occurred\n   * - `at`: Location or context where the error occurred\n   * - `intent`: Associated intent that caused the error\n   * - `content`: Additional error content or context\n   * - `recurrence`: Information about error recurrence patterns\n   * - `code`: Error code for programmatic error handling\n   * - `status`: Finalization status indicating how the error was resolved\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid input provided\");\n   *\n   * const contextError = new DwnError(\"SCRIPT_ERROR\", \"Script execution failed\", {\n   *   state: { id: \"state-123\", service: \"main\" },\n   *   intent: \"user-input\",\n   *   content: \"invalid data\",\n   *   messages: [\"First attempt failed\", \"Retry failed\"],\n   *   goto: { id: \"error-handler\", service: \"main\" }\n   * });\n   * ```\n   */\n  constructor(type, description, extras) {\n    super();\n    this.name = \"DwnError\";\n    const _extras = _DwnError.enforceExtras(extras);\n    this.type = type;\n    this.description = description;\n    this.at = _extras.at;\n    this.content = _extras.content;\n    this.state = _extras.state;\n    this.recurrence = _extras.recurrence;\n    this.goto = _extras.goto;\n    this.message = _extras.message || undefined;\n    this.messages = _extras.messages || [];\n    this.intent = _extras.intent || undefined;\n    this.code = _extras.code || undefined;\n    this.status = _extras.status || undefined;\n    this.stack = _extras.stack || undefined;\n    if (!this.stack) {\n      if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, _DwnError);\n      }\n    }\n  }\n  /**\n   * Creates a DwnError instance from a serialized error string.\n   *\n   * Parses a DWN error string in the format \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\"\n   * and reconstructs the original DwnError instance.\n   *\n   * @param {string} dwnErrorString Serialized error string from toString() method\n   * @returns {DwnError | undefined} DwnError instance or undefined if parsing fails\n   *\n   * @example\n   * ```typescript\n   * const errorString = \"SCRIPT_ERROR -|- Execution failed -|- {...}\";\n   * const error = DwnError.fromDwnError(errorString);\n   * ```\n   */\n  static fromDwnError(dwnErrorString) {\n    if (!dwnErrorString) return undefined;\n    const parts = dwnErrorString.split(\"-|-\");\n    let type = parts.shift();\n    if (!type) {\n      return undefined;\n    }\n    type = type.trim();\n    let description = parts.shift() || \"\";\n    if (description) {\n      description = description.trim();\n    }\n    let extras = undefined;\n    try {\n      extras = JSON.parse(parts.shift() || \"{}\");\n    } catch (e) {\n    }\n    if (extras) {\n      return new _DwnError(type, description, extras);\n    }\n    return new _DwnError(type, description);\n  }\n  /**\n   * Creates a DwnError instance from a JSON object.\n   *\n   * Converts a generic Error object or JSON representation into a properly\n   * structured DwnError instance with all required properties.\n   *\n   * @param {Error} data Error object or JSON data to convert\n   * @returns {DwnError} New DwnError instance\n   *\n   * @example\n   * ```typescript\n   * const jsonData = { type: \"API_ERROR\", description: \"Request failed\" };\n   * const error = DwnError.fromJson(jsonData);\n   * ```\n   */\n  static fromJson(data) {\n    const extras = _DwnError.enforceExtras(data);\n    return new _DwnError(data.type, data.description, extras);\n  }\n  /**\n   * Normalizes and validates error extras properties.\n   *\n   * Ensures all optional properties have default values and validates the structure\n   * of the extras object. Used internally to maintain consistency across error instances.\n   *\n   * @param {DwnError | DwnErrorExtras} [entity] Error entity or extras object to normalize\n   * @returns {Required<DwnErrorExtras>} Normalized extras object with all required properties\n   *\n   * @internal\n   */\n  static enforceExtras(entity) {\n    if (!entity) entity = {};\n    const extras = {};\n    extras.message = entity.message || \"\";\n    extras.messages = entity.messages || [];\n    extras.stack = entity.stack || \"\";\n    extras.goto = entity.goto;\n    extras.state = entity.state || { id: \"\", service: \"\" };\n    extras.at = entity.at || (new Date()).toISOString();\n    extras.intent = entity.intent || \"\";\n    extras.content = entity.content || \"\";\n    extras.recurrence = entity.recurrence || { type: 1, state: 1, combined: 1 };\n    extras.code = entity.code || undefined;\n    extras.status = entity.status || undefined;\n    return extras;\n  }\n  /**\n   * Serializes the error to a string format.\n   *\n   * Converts the DwnError instance into a parseable string format using the pattern\n   * \"TYPE -|- DESCRIPTION -|- EXTRAS_JSON\" for storage or transmission.\n   *\n   * @returns {string} Serialized error string\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"API_ERROR\", \"Request failed\");\n   * const serialized = error.toString();\n   * // \"API_ERROR -|- Request failed -|- {...}\"\n   * ```\n   */\n  toString() {\n    const extras = JSON.stringify(_DwnError.enforceExtras(this));\n    return `${this.type} -|- ${this.description} -|- ${extras}`;\n  }\n  /**\n   * Converts the error to a JSON object.\n   *\n   * Serializes all error properties into a plain JavaScript object suitable\n   * for JSON serialization, API responses, or logging.\n   *\n   * @returns {Error} Plain object representation of the error\n   *\n   * @example\n   * ```typescript\n   * const error = new DwnError(\"VALIDATION_ERROR\", \"Invalid data\");\n   * const json = error.toJson();\n   * console.log(JSON.stringify(json, null, 2));\n   * ```\n   */\n  toJson() {\n    return {\n      type: this.type,\n      at: this.at,\n      description: this.description,\n      message: this.message,\n      messages: this.messages || [],\n      stack: this.stack || \"\",\n      intent: this.intent,\n      content: this.content,\n      goto: this.goto,\n      state: this.state,\n      recurrence: this.recurrence\n    };\n  }\n};\nvar SYSTEM_DWN_ERRORS = [\n  \"RUNTIME_ERROR\",\n  \"MISCONFIGURATION_ERROR\"\n];\n\n\nfunction enforceState(state, currentService, states) {\n  if (!state && typeof state !== \"string\") {\n    return state;\n  }\n  const id = typeof state === \"string\" ? state : state.id;\n  if (!id) {\n    throw new DwnError(\n      \"MISCONFIGURATION_ERROR\",\n      `State ${JSON.stringify(state)} must have 'id' property.`\n    );\n  }\n  const key = `${id}@${currentService}`;\n  let service = typeof state === \"string\" ? currentService : state.service;\n  if (!service) {\n    service = currentService;\n  }\n  let name = typeof state === \"string\" ? \"\" : state.name;\n  if (!name) {\n    name = states[key] || undefined;\n  }\n  return { id, service, name };\n}\n",
                    "inputVariables": [
                        "dwn",
                        "dwnCore",
                        "dwnConfig",
                        "dwnStates",
                        "dwnError",
                        "resource.dwnListConfig",
                        "tunnel.originator",
                        "contact.serialized"
                    ],
                    "outputVariable": "dwn"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "notExists",
                        "variable": "dwnBypass"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_RST_INT_CNT#adaa1370-56a0-4ba1-ad73-15a7cf1f1db4",
                "$typeOfContent": "",
                "type": "MergeContact",
                "$title": "DWN Reset contact intent",
                "settings": {
                    "extras": {
                        "intent": ""
                    }
                },
                "conditions": [
                    {
                        "source": "context",
                        "comparison": "exists",
                        "values": [],
                        "variable": "contact.extras.intent"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_TRK_PREP_INT#ba3e85a8-c56b-4e95-b0b1-d339580544e6",
                "$typeOfContent": "",
                "type": "TrackEvent",
                "$title": "DWN Prepare Intents",
                "settings": {
                    "extras": {
                        "journey": "{{dwn@journey}}"
                    },
                    "category": "dwn-prepare-intents-{{dwn@intent.event}}",
                    "action": "{{dwn@intent.label}}"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent"
                    },
                    {
                        "values": [
                            "prepare"
                        ],
                        "source": "context",
                        "comparison": "equals",
                        "variable": "dwn@intent.scope"
                    },
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent.id"
                    },
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent.label"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_TRK_PREP_INT_UNX#993782ec-707e-43ac-86b5-14f3e13f5b6d",
                "$typeOfContent": "",
                "type": "TrackEvent",
                "$title": "DWN Prepare Intents with unexpected",
                "settings": {
                    "extras": {
                        "journey": "{{dwn@journey}}"
                    },
                    "category": "dwn-prepare-intents-{{dwn@intent.event}}",
                    "action": "{{dwn@intent.label}}"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent"
                    },
                    {
                        "values": [
                            "prepare"
                        ],
                        "source": "context",
                        "comparison": "equals",
                        "variable": "dwn@intent.scope"
                    },
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent.label"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_TRK_PREP_INT_GLB_UNX#fc3da05b-5218-44cb-bd7f-89c2b59068fb",
                "$typeOfContent": "",
                "type": "TrackEvent",
                "$title": "DWN Prepare unexpected intents",
                "settings": {
                    "extras": {
                        "journey": "{{dwn@journey}}"
                    },
                    "category": "dwn-prepare-intents-global-unexpected",
                    "action": "{{dwnCore@state.name}}"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent"
                    },
                    {
                        "values": [
                            "prepare"
                        ],
                        "source": "context",
                        "comparison": "equals",
                        "variable": "dwn@intent.scope"
                    },
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "notExists",
                        "variable": "dwn@intent.id"
                    },
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwnCore@state.name"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_TRK_PREP_INT_LST#75c30a72-09c5-43b5-b94b-f19eea67d31a",
                "$typeOfContent": "",
                "type": "TrackEvent",
                "$title": "DWN Stack Intent List",
                "settings": {
                    "extras": {
                        "journey": "{{dwn@journey}}"
                    },
                    "category": "dwn-prepare-intents-list-{{dwn@intent.event}}",
                    "action": " | {{dwn@calendar.datetime}} | {{contact.identity}} | {{dwn@intent.label}} | {{dwn@intent.type}} | {{dwn@input.content}} | {{dwn@intent.pattern}} | {{dwn@intent.score}}"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent"
                    },
                    {
                        "values": [
                            "prepare"
                        ],
                        "source": "context",
                        "comparison": "equals",
                        "variable": "dwn@intent.scope"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_TRK_PREP_INT_UNM_LST#0bda804f-da92-4c3c-b8d4-7457bae8f40a",
                "$typeOfContent": "",
                "type": "TrackEvent",
                "$title": "DWN Prepare Unmatched Intent List",
                "settings": {
                    "extras": {
                        "journey": "{{dwn@journey}}"
                    },
                    "category": "dwn-prepare-intents-list-unmatched",
                    "action": " | {{dwn@calendar.datetime}} | {{contact.identity}} | {{dwn@intent.type}} | {{dwn@input.content}} | {{dwn@intent.score}}"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent"
                    },
                    {
                        "values": [
                            "prepare"
                        ],
                        "source": "context",
                        "comparison": "equals",
                        "variable": "dwn@intent.scope"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_TRK_INA#2d3adf11-8053-4798-9c63-36460d7aada7",
                "$typeOfContent": "",
                "type": "TrackEvent",
                "$title": "DWN Inactivity",
                "settings": {
                    "extras": {
                        "journey": "{{dwn@journey}}"
                    },
                    "category": "dwn-inactivity",
                    "action": "{{dwnCore@state.name}}"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "input",
                        "comparison": "notExists"
                    },
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwnCore@state.name"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_TRK_STK_INT#004ac40d-990e-4f4e-8ee4-046be2d77bd1",
                "$typeOfContent": "",
                "type": "TrackEvent",
                "$title": "DWN Stack Intent",
                "settings": {
                    "extras": {
                        "journey": "{{dwn@journey}}"
                    },
                    "category": "dwn-stack-intents-{{dwn@intent.event}}",
                    "action": "{{dwn@intent.label}}"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent"
                    },
                    {
                        "values": [
                            "stack"
                        ],
                        "source": "context",
                        "comparison": "equals",
                        "variable": "dwn@intent.scope"
                    },
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent.label"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_TRK_STK_INT_LST#51d4406b-5e80-4084-800d-6ec477bc2570",
                "$typeOfContent": "",
                "type": "TrackEvent",
                "$title": "DWN Stack Intent List",
                "settings": {
                    "extras": {
                        "journey": "{{dwn@journey}}"
                    },
                    "category": "dwn-stack-intents-list",
                    "action": " | {{dwn@calendar.datetime}} | {{contact.identity}} | {{dwn@intent.event}} | {{dwn@intent.label}} | {{dwn@intent.type}} | {{dwn@input.content}} | {{dwn@intent.pattern}} | {{dwn@intent.score}}"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent"
                    },
                    {
                        "values": [
                            "stack"
                        ],
                        "source": "context",
                        "comparison": "equals",
                        "variable": "dwn@intent.scope"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_TRK_CFG_INT#985db723-0e33-4986-b74a-6b7c77fea305",
                "$typeOfContent": "",
                "type": "TrackEvent",
                "$title": "DWN Config Intent",
                "settings": {
                    "extras": {
                        "journey": "{{dwn@journey}}"
                    },
                    "category": "dwn-config-intents-{{dwn@intent.event}}",
                    "action": "{{dwn@intent.label}}"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent"
                    },
                    {
                        "values": [
                            "config"
                        ],
                        "source": "context",
                        "comparison": "equals",
                        "variable": "dwn@intent.scope"
                    },
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent.label"
                    }
                ],
                "$invalid": false
            },
            {
                "$id": "DWN/GLB_TRK_CFG_INT_LST#6a9f009e-7239-415c-bc2e-982669c75c47",
                "$typeOfContent": "",
                "type": "TrackEvent",
                "$title": "DWN Config Intent List",
                "settings": {
                    "extras": {
                        "journey": "{{dwn@journey}}"
                    },
                    "category": "dwn-config-intents-list",
                    "action": " | {{dwn@calendar.datetime}} | {{contact.identity}} | {{dwn@intent.event}} | {{dwn@intent.label}} | {{dwn@intent.type}} | {{dwn@input.content}} | {{dwn@intent.pattern}} | {{dwn@intent.score}}"
                },
                "conditions": [
                    {
                        "values": [],
                        "source": "context",
                        "comparison": "exists",
                        "variable": "dwn@intent"
                    },
                    {
                        "values": [
                            "config"
                        ],
                        "source": "context",
                        "comparison": "equals",
                        "variable": "dwn@intent.scope"
                    }
                ],
                "$invalid": false
            }
        ],
        "$leavingCustomActions": [],
        "$inputSuggestions": [],
        "$defaultOutput": {
            "stateId": "fallback",
            "$invalid": false
        },
        "$localCustomActions": [],
        "isAiGenerated": false,
        "$tags": [],
        "id": "global-actions",
        "$invalidContentActions": false,
        "$invalidOutputs": false,
        "$invalidCustomActions": false,
        "$invalid": false
    }
}